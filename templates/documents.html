<form id="documents-form" autocomplete="off">
  <div class="bg-white rounded-2xl shadow p-8 mb-8">
    <div class="flex items-center gap-2 mb-6">
      <i class="fas fa-file-alt text-blue-500 text-2xl"></i>
      <h2 class="text-lg font-semibold text-blue-600">Documentos</h2>
    </div>

    <!-- Lista de Documentos -->
    <div id="documentsList" class="space-y-4">
      <!-- Campo de pesquisa centralizado -->
      <div class="mb-6">
        <div class="relative max-w-lg mx-auto">
          <input type="text" id="documento-pesquisa" class="peer w-full rounded-lg border border-gray-300 focus:border-blue-600 focus:ring-2 focus:ring-blue-100 px-4 py-3 text-gray-800 bg-gray-50 transition-colors duration-200" placeholder="Digite para pesquisar ou adicionar um documento...">
          <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400">
            <i class="fas fa-search"></i>
          </div>
        </div>

        <!-- Resultados da pesquisa (aparecerão abaixo do campo) -->
        <div id="resultados-pesquisa" class="max-w-lg mx-auto hidden">
          <!-- Essa div será preenchida via JavaScript -->
        </div>
      </div>

      <!-- Lista de documentos adicionados -->
      <div id="documentos-container" class="space-y-4 my-6">
        <!-- Documentos adicionados serão inseridos aqui -->
      </div>
    </div>
  </div>

  <!-- Observações -->
  <div class="relative mt-8">
    <textarea id="observacoes" rows="3" class="peer w-full rounded-lg border border-gray-300 focus:border-blue-600 focus:ring-2 focus:ring-blue-100 px-4 py-3 text-gray-800 bg-gray-50 placeholder-gray-400 transition-colors duration-200" placeholder="Observações sobre os documentos..."></textarea>
    <label for="observacoes" class="input-label">
      Observações
    </label>
  </div>

  <!-- Botões de navegação -->
  <div class="flex justify-between mt-8">
    <button type="button" id="btn-back" class="bg-white hover:bg-gray-100 text-blue-600 font-semibold rounded-lg px-8 py-3 text-base shadow border border-blue-200 transition focus:outline-none focus:ring-2 focus:ring-blue-100 flex items-center gap-2">
      <i class="fas fa-arrow-left"></i> Anterior
    </button>

    <button type="submit" id="btn-save" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg px-8 py-3 text-base shadow transition focus:outline-none focus:ring-2 focus:ring-blue-300 flex items-center gap-2">
      <i class="fas fa-save"></i> Salvar
    </button>
  </div>
</form>

<!-- Template para novo documento adicionado -->
<template id="documentoTemplate">
  <div class="documento-adicionado relative p-3 bg-gray-50 rounded-lg shadow-sm mb-2">
    <!-- Layout compacto com três colunas principais -->
    <div class="flex items-center">
      <!-- Coluna 1: Nome e status (maior largura) -->
      <div class="flex-grow pr-2">
        <div class="flex flex-wrap items-center">
          <input type="text" class="nome-documento text-gray-800 bg-transparent border-b border-gray-300 focus:border-blue-600 focus:ring-1 focus:ring-blue-100 px-2 py-1 w-full" placeholder="Nome do documento">
        </div>
      </div>

      <!-- Coluna 2: Status e ano (compacto) -->
      <div class="flex items-center gap-2">
        <select class="status-documento text-xs text-gray-800 bg-gray-50 border border-gray-300 rounded px-2 py-1" onchange="toggleDocumentFields(this)">
          <option value="" selected disabled>Status</option>
          <option value="disponivel">Disponível</option>
          <option value="solicitar">Solicitar</option>
          <option value="solicitado_orgao">Órgão/empresa</option>
          <option value="nao_disponivel">Indisponível</option>
        </select>

        <input type="number" min="1900" max="2099" class="ano-documento text-xs w-16 text-gray-800 bg-gray-50 border border-gray-300 rounded px-2 py-1" placeholder="Ano">
      </div>

      <!-- Coluna 3: Controles (mínimo possível) -->
      <div class="ml-2 flex items-center gap-1">
        <button type="button" class="expandir-documento bg-gray-200 hover:bg-gray-300 text-gray-600 rounded-full p-1 flex items-center justify-center w-6 h-6 text-xs" title="Expandir detalhes">
          <i class="fas fa-chevron-down"></i>
        </button>
        <button type="button" class="remover-documento bg-red-500 hover:bg-red-600 text-white rounded-full p-1 flex items-center justify-center w-6 h-6 text-xs" title="Remover documento">
          <i class="fas fa-minus"></i>
        </button>
      </div>
    </div>

    <!-- Área de detalhes (inicialmente oculta) -->
    <div class="documento-detalhes hidden mt-3 pt-2 border-t border-gray-200">
      <!-- Detalhes adicionais do documento -->
      <div class="relative document-field mb-3">
        <label class="text-xs text-gray-600 mb-1 block">Detalhes do documento</label>
        <textarea class="detalhes-documento w-full rounded-lg border border-gray-300 focus:border-blue-600 focus:ring-2 focus:ring-blue-100 px-3 py-2 text-gray-800 bg-gray-50 text-sm" rows="2" placeholder="Informações adicionais, número de série, data de emissão, órgão emissor, etc."></textarea>
      </div>

      <!-- Campos específicos para cada status - todos inicialmente ocultos -->
      <div class="document-status-fields disponivel-fields hidden mb-3">
        <label class="text-xs text-gray-600 mb-1 block">Considerações</label>
        <textarea class="w-full rounded-lg border border-gray-300 focus:border-blue-600 focus:ring-2 focus:ring-blue-100 px-3 py-2 text-gray-800 bg-gray-50 text-sm" rows="1" placeholder="Observações sobre o documento disponível"></textarea>
      </div>

      <div class="document-status-fields solicitar-fields hidden mb-3">
        <div class="grid grid-cols-2 gap-3 mb-2">
          <div>
            <label class="text-xs text-gray-600 mb-1 block">Data da solicitação</label>
            <input type="date" class="w-full rounded-lg border border-gray-300 focus:border-blue-600 focus:ring-2 focus:ring-blue-100 px-3 py-1 text-sm">
          </div>
          <div>
            <label class="text-xs text-gray-600 mb-1 block">Prazo para entrega</label>
            <input type="date" class="w-full rounded-lg border border-gray-300 focus:border-blue-600 focus:ring-2 focus:ring-blue-100 px-3 py-1 text-sm">
          </div>
        </div>
        <label class="text-xs text-gray-600 mb-1 block">Instruções para o cliente</label>
        <textarea class="w-full rounded-lg border border-gray-300 focus:border-blue-600 focus:ring-2 focus:ring-blue-100 px-3 py-2 text-gray-800 bg-gray-50 text-sm" rows="1" placeholder="Instruções específicas para o cliente"></textarea>
      </div>

      <div class="document-status-fields solicitado_orgao-fields hidden mb-3">
        <div class="grid grid-cols-2 gap-3 mb-2">
          <div>
            <label class="text-xs text-gray-600 mb-1 block">Órgão/Empresa</label>
            <input type="text" class="w-full rounded-lg border border-gray-300 focus:border-blue-600 focus:ring-2 focus:ring-blue-100 px-3 py-1 text-sm" placeholder="Nome do órgão ou empresa">
          </div>
          <div>
            <label class="text-xs text-gray-600 mb-1 block">Forma de solicitação</label>
            <input type="text" class="w-full rounded-lg border border-gray-300 focus:border-blue-600 focus:ring-2 focus:ring-blue-100 px-3 py-1 text-sm" placeholder="Ex: ofício, processo administrativo">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="text-xs text-gray-600 mb-1 block">Data da solicitação</label>
            <input type="date" class="w-full rounded-lg border border-gray-300 focus:border-blue-600 focus:ring-2 focus:ring-blue-100 px-3 py-1 text-sm">
          </div>
          <div>
            <label class="text-xs text-gray-600 mb-1 block">Prazo/Protocolo</label>
            <input type="text" class="w-full rounded-lg border border-gray-300 focus:border-blue-600 focus:ring-2 focus:ring-blue-100 px-3 py-1 text-sm" placeholder="Ex: 30 dias, nº protocolo">
          </div>
        </div>
      </div>

      <div class="document-status-fields nao_disponivel-fields hidden mb-3">
        <label class="text-xs text-gray-600 mb-1 block">Motivo e alternativas</label>
        <textarea class="w-full rounded-lg border border-gray-300 focus:border-blue-600 focus:ring-2 focus:ring-blue-100 px-3 py-2 text-gray-800 bg-gray-50 text-sm" rows="1" placeholder="Motivo da indisponibilidade e possíveis alternativas"></textarea>
      </div>
    </div>
  </div>
</template>

<!-- Scripts -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    if (window.initModule) {
      window.initModule();
    }
  });

  // Função global para alternar visibilidade dos campos de documento
  function toggleDocumentFields(selectElement) {
    if (!selectElement) return;

    const documentoElement = selectElement.closest('.documento-adicionado');
    if (!documentoElement) return;

    const status = selectElement.value;

    // Esconder todos os campos de status primeiro
    documentoElement.querySelectorAll('.document-status-fields').forEach(field => {
      field.classList.add('hidden');
    });

    // Mostrar os campos específicos para o status selecionado
    if (status) {
      const campos = documentoElement.querySelector(`.${status}-fields`);
      if (campos) {
        campos.classList.remove('hidden');
      }

      // Garantir que a área de detalhes esteja visível quando um status é selecionado
      const detalhesArea = documentoElement.querySelector('.documento-detalhes');
      if (detalhesArea && detalhesArea.classList.contains('hidden')) {
        detalhesArea.classList.remove('hidden');
        const expandirBtn = documentoElement.querySelector('.expandir-documento');
        if (expandirBtn) {
          expandirBtn.innerHTML = '<i class="fas fa-chevron-up"></i>';
        }
      }
    }
  }
</script>


