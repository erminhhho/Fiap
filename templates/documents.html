<form id="documents-form" autocomplete="off">
  <div class="bg-white rounded-2xl shadow p-8 mb-8">
    <div class="flex items-center justify-between gap-2 mb-6">
      <div class="flex items-center gap-2">
        <i class="fas fa-file-alt text-blue-500 text-2xl"></i>
        <h2 class="text-xl font-semibold text-blue-600">Documentos</h2>
      </div>
      <i class="fas fa-eraser cursor-pointer text-gray-400 hover:text-red-500 transition" title="Limpar seção" onclick="showClearConfirmation(event, 'documentos')"></i>
    </div>

    <!-- Lista de Documentos -->
    <div id="documentsList" class="space-y-1">
      <!-- Campo de pesquisa centralizado com design mais compacto -->
      <div class="relative mb-3 max-w-lg mx-auto">
        <input type="text" id="documento-pesquisa" class="peer w-full rounded-lg border border-gray-300 focus:border-blue-600 focus:ring-2 focus:ring-blue-100 px-4 py-3 text-gray-800 bg-gray-50 placeholder-gray-400 transition-colors duration-200 text-base" placeholder="Digite o nome do documento para pesquisar ou adicionar...">
        <div class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400">
          <i class="fas fa-search"></i>
        </div>
      </div>

      <!-- Resultados da pesquisa (aparecerão abaixo do campo) -->
      <div id="resultados-pesquisa" class="max-w-lg mx-auto hidden">
        <!-- Essa div será preenchida via JavaScript -->
      </div>

      <!-- Lista de documentos adicionados com espaçamento reduzido -->
      <div id="documentos-container" class="space-y-1 my-3">
        <!-- Documentos adicionados serão inseridos aqui -->
      </div>
    </div>
  </div>

  <!-- Observações -->
  <div class="relative mt-6">
    <textarea id="observacoes" rows="3" class="peer w-full rounded-lg border border-gray-300 focus:border-blue-600 focus:ring-2 focus:ring-blue-100 px-4 py-3 text-gray-800 bg-gray-50 placeholder-gray-400 transition-colors duration-200 text-base" placeholder="Observações sobre os documentos..."></textarea>
    <label for="observacoes" class="input-label text-base">
      Observações
    </label>
  </div>

  <!-- Botões de navegação -->
  <div class="flex justify-between mt-6">
    <button type="button" id="btn-back" class="bg-white hover:bg-gray-100 text-blue-600 font-semibold rounded-lg px-6 py-2 text-base shadow border border-blue-200 transition focus:outline-none focus:ring-2 focus:ring-blue-100 flex items-center gap-2">
      <i class="fas fa-arrow-left"></i> Anterior
    </button>

    <button type="button" id="btn-print" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg px-6 py-2 text-base shadow transition focus:outline-none focus:ring-2 focus:ring-blue-300 flex items-center gap-2" onclick="printForm()">
      <i class="fas fa-print"></i> Imprimir
    </button>
  </div>
</form>

<!-- Template para novo documento adicionado -->
<template id="documentoTemplate">
  <div class="documento-adicionado relative p-3 bg-white rounded-lg border border-gray-200 shadow-sm mb-2 hover:border-blue-200 transition-colors">
    <!-- Layout em grid com 3 colunas -->
    <div class="flex flex-col sm:flex-row items-start gap-2">
      <!-- Coluna 1: Nome do documento e detalhes -->
      <div class="flex-grow min-w-0 w-full sm:w-auto">
        <div class="flex items-center mb-2">
          <i class="fas fa-file-alt text-blue-500 mr-2"></i>
          <input type="text" class="nome-documento text-base font-medium text-gray-800 bg-transparent border-b border-gray-200 focus:border-blue-600 focus:ring-0 px-1 py-0.5 w-full" placeholder="Nome do documento">
        </div>

        <!-- Ano em campo separado -->
        <div class="flex items-center text-sm text-gray-600 mb-1">
          <i class="fas fa-calendar-alt text-gray-400 mr-1 w-4 text-center"></i>
          <input type="number" min="1900" max="2099" class="ano-documento bg-transparent border-0 border-b border-gray-200 focus:border-blue-500 focus:ring-0 px-1 py-0.5 w-16" placeholder="Ano">
        </div>

        <!-- Campo de detalhes expansível -->
        <div class="detalhes-documento-container text-sm text-gray-600 hidden">
          <textarea class="detalhes-documento w-full rounded border border-gray-200 focus:border-blue-600 focus:ring-1 focus:ring-blue-100 px-2 py-1 text-gray-700 bg-gray-50 text-sm mt-1" rows="2" placeholder="Detalhes adicionais sobre o documento..."></textarea>
        </div>
      </div>

      <!-- Coluna 2: Status com tags -->
      <div class="flex items-center space-x-2 mt-1 sm:mt-0">
        <!-- Tag de status "Recebido" -->
        <button type="button" class="documento-tag rounded-full px-3 py-1 text-xs font-medium bg-green-100 text-green-800 border border-green-200 hover:bg-green-200 transition-colors" data-status="recebido" onclick="toggleDocumentStatus(this)">
          <i class="fas fa-check-circle mr-1"></i>Recebido
        </button>

        <!-- Tag de status "Solicitado" -->
        <button type="button" class="documento-tag rounded-full px-3 py-1 text-xs font-medium bg-gray-100 text-gray-500 border border-gray-200 hover:bg-blue-100 hover:text-blue-700 hover:border-blue-200 transition-colors" data-status="solicitado" onclick="toggleDocumentStatus(this)">
          <i class="fas fa-clock mr-1"></i>Solicitado
        </button>

        <!-- Tag de status "Obter" -->
        <button type="button" class="documento-tag rounded-full px-3 py-1 text-xs font-medium bg-gray-100 text-gray-500 border border-gray-200 hover:bg-yellow-100 hover:text-yellow-700 hover:border-yellow-200 transition-colors" data-status="obter" onclick="toggleDocumentStatus(this)">
          <i class="fas fa-exclamation-circle mr-1"></i>Obter
        </button>
      </div>

      <!-- Coluna 3: Botões de controle -->
      <div class="flex items-center space-x-1 mt-1 sm:mt-0">
        <button type="button" class="expandir-documento w-7 h-7 flex items-center justify-center rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors" title="Expandir detalhes">
          <i class="fas fa-chevron-down text-xs"></i>
        </button>
        <button type="button" class="remover-documento w-7 h-7 flex items-center justify-center rounded-full bg-red-100 text-red-600 hover:bg-red-200 transition-colors" title="Remover documento">
          <i class="fas fa-trash-alt text-xs"></i>
        </button>
      </div>
    </div>
  </div>
</template>

<!-- Scripts -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    if (window.initModule) {
      window.initModule();
    }
  });

  // Função para alternar o status de um documento
  function toggleDocumentStatus(button) {
    if (!button) return;

    const documentoElement = button.closest('.documento-adicionado');
    if (!documentoElement) return;

    const statusValue = button.dataset.status;
    const allTags = documentoElement.querySelectorAll('.documento-tag');

    // Primeiro, reseta todas as tags para seu estado inicial
    allTags.forEach(tag => {
      tag.classList.remove('bg-green-100', 'text-green-800', 'border-green-200',
                          'bg-blue-100', 'text-blue-700', 'border-blue-200',
                          'bg-yellow-100', 'text-yellow-700', 'border-yellow-200');

      tag.classList.add('bg-gray-100', 'text-gray-500', 'border-gray-200');
    });

    // Depois, ativa a tag selecionada com o estilo apropriado
    if (statusValue === 'recebido') {
      button.classList.remove('bg-gray-100', 'text-gray-500', 'border-gray-200');
      button.classList.add('bg-green-100', 'text-green-800', 'border-green-200');
    } else if (statusValue === 'solicitado') {
      button.classList.remove('bg-gray-100', 'text-gray-500', 'border-gray-200');
      button.classList.add('bg-blue-100', 'text-blue-700', 'border-blue-200');
    } else if (statusValue === 'obter') {
      button.classList.remove('bg-gray-100', 'text-gray-500', 'border-gray-200');
      button.classList.add('bg-yellow-100', 'text-yellow-700', 'border-yellow-200');
    }

    // Atualizamos um atributo data no elemento do documento para facilitar o acesso ao status atual
    documentoElement.dataset.status = statusValue;
  }

  // Função para expandir/contrair os detalhes do documento
  function toggleDocumentFields(button) {
    if (!button) return;

    const documentoElement = button.closest('.documento-adicionado');
    if (!documentoElement) return;

    const detalhesArea = documentoElement.querySelector('.detalhes-documento-container');
    const icon = button.querySelector('i');

    if (detalhesArea) {
      if (detalhesArea.classList.contains('hidden')) {
        detalhesArea.classList.remove('hidden');
        icon.classList.remove('fa-chevron-down');
        icon.classList.add('fa-chevron-up');
      } else {
        detalhesArea.classList.add('hidden');
        icon.classList.remove('fa-chevron-up');
        icon.classList.add('fa-chevron-down');
      }
    }
  }
</script>


