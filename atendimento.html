<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Ficha de Atendimento Previdenciário</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Font Awesome para ícones -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Flatpickr (calendário moderno) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/monthSelect/style.css">
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Flatpickr JS e tradução para português -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pt.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/monthSelect/index.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8f9fa;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }

    .container-fluid {
      width: 100%;
      margin: 0;
      padding: 0;
    }

    .content-wrapper {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.5rem;
    }

    h1, h2, h3 {
      color: #0d6efd;
      font-weight: 600;
    }
    h2 {
      margin-top: 32px;
      font-size: 1.5rem;
      position: relative;
      padding-bottom: 8px;
    }
    h2::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 40px;
      height: 3px;
      background-color: #0d6efd;
      border-radius: 2px;
    }
    .section { margin-bottom: 32px; }
    .step { padding: 20px; }
    .dynamic-list { margin-bottom: 10px; }
    .dynamic-item {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      background: #f8f9fa;
      position: relative;
      transition: all 0.2s ease;
    }
    .dynamic-item:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .remove-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #dc3545;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 2px 8px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.2s ease;
    }
    .remove-btn:hover {
      background: #bd2130;
      transform: scale(1.05);
    }
    .add-btn {
      background: #198754;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 8px 16px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .add-btn:hover {
      background: #146c43;
      transform: translateY(-1px);
    }
    .checkbox-list {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 15px;
    }
    .checkbox-list label {
      font-weight: normal;
      display: flex;
      align-items: center;
      margin-right: 0;
      margin-top: 0;
      cursor: pointer;
      background: #f0f0f0;
      padding: 6px 10px;
      border-radius: 4px;
      border: 1px solid #ddd;
      transition: all 0.2s ease;
    }
    .checkbox-list label:hover {
      background: #e9ecef;
      border-color: #ced4da;
    }
    .checkbox-list input[type="checkbox"] {
      width: auto;
      margin-right: 6px;
      margin-bottom: 0;
    }

    @media (max-width: 768px) {
      .content-wrapper { padding: 16px; }
      .step { padding: 10px; }
    }
    @media print {
      body { background: #fff; }
      .content-wrapper { box-shadow: none; max-width: 100%; }
      .add-btn, .remove-btn, .print-btn { display: none !important; }
      input, select, textarea {
        border: none;
        padding: 0;
        border-radius: 0;
      }
      .dynamic-item {
        padding: 8px;
        margin-bottom: 8px;
        border: 1px solid #ddd;
      }
    }
    .print-btn {
      background: #0d6efd;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 8px 18px;
      font-size: 1rem;
      float: right;
      margin-top: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .print-btn:hover {
      background: #0b5ed7;
      transform: translateY(-1px);
    }

    /* Componentes personalizados */
    .info-card {
      border-left: 4px solid #0d6efd;
      background-color: rgba(13, 110, 253, 0.05);
      padding: 12px 16px;
      border-radius: 6px;
      margin-bottom: 20px;
    }
    .data-block {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      margin-bottom: 24px;
      overflow: hidden;
    }
    .data-block-header {
      background: #f8f9fa;
      padding: 12px 16px;
      border-bottom: 1px solid #e9ecef;
      font-weight: 600;
      color: #495057;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .data-block-body {
      padding: 16px;
    }

    /* Utilizamos as configurações padrão do Bootstrap para form-floating */

    /* Navegação entre etapas */
    .step-navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 24px;
    }
    .step-back {
      background: #6c757d;
      color: white;
    }
    /* Melhorias no mapa de progresso - design mais moderno e atraente */
    .progress-indicator {
      display: flex;
      justify-content: space-between;
      margin: 20px auto 30px;
      max-width: 900px;
      position: relative;
      padding: 0;
      background: transparent;
      box-shadow: none;
      overflow: visible;
    }

    .progress-indicator::before {
      content: '';
      position: absolute;
      top: 20px;
      left: 40px;
      right: 40px;
      height: 3px;
      background: linear-gradient(to right, #20c997 var(--progress, 0%), #e9ecef var(--progress, 0%));
      z-index: 1;
    }

    .progress-step {
      position: relative;
      z-index: 2;
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      min-width: 80px;
    }

    .progress-step-number {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 8px;
      position: relative;
      transition: all 0.3s ease;
      background-color: #fff;
      color: #6c757d;
      border: 2px solid #e9ecef;
      box-shadow: 0 0 0 4px #fff;
    }

    .progress-step-label {
      font-size: 0.8rem;
      color: #6c757d;
      text-align: center;
      max-width: 100px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .progress-step.active .progress-step-number {
      background-color: #0d6efd;
      color: white;
      border-color: #0d6efd;
      transform: scale(1.2);
      box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.25);
    }

    .progress-step.active .progress-step-label {
      color: #0d6efd;
      font-weight: 600;
    }

    .progress-step.completed .progress-step-number {
      background-color: #20c997;
      color: white;
      border-color: #20c997;
    }

    @media (max-width: 768px) {
      .progress-indicator {
        overflow-x: auto;
        justify-content: flex-start;
        padding-bottom: 15px;
      }

      .progress-step {
        min-width: 100px;
        margin-right: 10px;
      }
    }

    .step-link {
      position: relative;
      padding: 8px;
      margin: 0 3px;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      font-size: 1.2rem;
    }

    .step-link:hover {
      background-color: rgba(13, 110, 253, 0.1);
      transform: translateY(-2px);
    }

    .step-link.active {
      background-color: rgba(32, 201, 151, 0.2);
      color: #20c997 !important;
      transform: scale(1.1);
      box-shadow: 0 2px 6px rgba(32, 201, 151, 0.3);
    }

    .step-link::after {
      content: attr(title);
      position: absolute;
      bottom: -25px;
      left: 50%;
      transform: translateX(-50%);
      padding: 4px 8px;
      background: rgba(0,0,0,0.7);
      color: white;
      border-radius: 4px;
      font-size: 11px;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s;
      z-index: 100;
    }

    .step-link:hover::after {
      opacity: 1;
      visibility: visible;
    }

    /* Estilo para cards de documentos */
    .doc-card {
      border: 1px solid #e0e0e0;
      border-radius: 5px;
      padding: 8px 12px;
      margin-bottom: 8px;
      transition: all 0.2s;
      background-color: #f8f9fa;
      position: relative;
    }

    .doc-card:hover {
      background-color: #e9ecef;
      border-color: #ced4da;
    }

    .doc-card .form-check-input:checked + .form-check-label {
      font-weight: 600;
      color: #0d6efd;
    }

    /* Adicionando status do documento */
    .doc-status {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.75rem;
      display: flex;
      align-items: center;
    }

    .status-apresentado {
      color: #198754;
    }

    .status-solicitado {
      color: #fd7e14;
    }
  </style>
</head>
<body>
  <div class="container-fluid">
    <div class="content-wrapper">
      <!-- Barra superior compacta: título + mapa de passos clicável e visualmente destacado -->
      <div class="d-flex align-items-center justify-content-between bg-light border-bottom px-2 py-1 mb-2" style="min-height:38px;">
        <span class="fw-semibold text-primary" style="font-size:1.1rem;">Ficha de Atendimento Previdenciário</span>
        <div class="d-flex align-items-center gap-2" id="step-map">
          <a href="#step-1" class="step-link text-primary" data-step="1" title="Dados Pessoais"><i class="fas fa-user"></i></a>
          <a href="#step-2" class="step-link text-primary" data-step="2" title="Perfil Social"><i class="fas fa-users"></i></a>
          <a href="#step-3" class="step-link text-primary" data-step="3" title="Saúde"><i class="fas fa-heartbeat"></i></a>
          <a href="#step-4" class="step-link text-primary" data-step="4" title="Segurado Especial"><i class="fas fa-shield-alt"></i></a>
          <a href="#step-5" class="step-link text-primary" data-step="5" title="Atividades Profissionais"><i class="fas fa-briefcase"></i></a>
          <a href="#step-6" class="step-link text-primary" data-step="6" title="Documentos e Conclusão"><i class="fas fa-file-alt"></i></a>
        </div>
      </div>

      <form id="multiStepForm" autocomplete="off">
        <!-- ETAPA 1: Dados Pessoais -->
        <div class="section step" id="step-1">
          <div class="info-card mb-4">
            <i class="fas fa-info-circle me-2"></i>
            Preencha os dados pessoais do cliente para avaliação previdenciária.
          </div>

          <div class="data-block">
            <div class="data-block-header">
              <i class="fas fa-user-circle text-primary"></i>
              Identificação e Contato
            </div>
            <div class="data-block-body">
              <div class="row g-3 mb-3">
                <div class="col-md-8">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="nome" name="nome" placeholder=" " required>
                    <label for="nome">Nome completo</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="apelido" name="apelido" placeholder=" ">
                    <label for="apelido">Apelido</label>
                  </div>
                </div>
              </div>

              <div class="row g-3 mb-3">
                <div class="col-md-4">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="nascimento" name="nascimento" placeholder=" " required oninput="maskDate(this)" onblur="calcularIdadeAutomatica()">
                    <label for="nascimento">Data de nascimento</label>
                  </div>
                </div>
                <div class="col-md-2">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="idade" name="idade" placeholder=" " readonly>
                    <label for="idade">Idade</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="cpf" name="cpf" placeholder=" " required oninput="maskCPF(this)" maxlength="14">
                    <label for="cpf">CPF</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <div class="input-group">
                      <input type="text" class="form-control" id="telefone" name="telefone" placeholder=" " oninput="maskPhone(this)">
                      <div class="input-group-text">
                        <div class="form-check form-switch mb-0">
                          <input class="form-check-input" type="checkbox" id="whatsapp_check" name="telefone_whatsapp" value="Sim">
                          <label class="form-check-label" for="whatsapp_check"><i class="fab fa-whatsapp text-success"></i></label>
                        </div>
                      </div>
                      <label for="telefone" class="floating-label">Telefone</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="data-block">
            <div class="data-block-header">
              <i class="fas fa-map-marker-alt text-primary"></i>
              Endereço
            </div>
            <div class="data-block-body">
              <!-- Campos de Endereço -->
              <div class="row g-3 mb-3">
                <div class="col-md-3">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="cep" name="cep" placeholder=" " oninput="maskCEP(this)">
                    <label for="cep">CEP</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="bairro" name="bairro" placeholder=" ">
                    <label for="bairro">Bairro</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="cidade" name="cidade" placeholder=" ">
                    <label for="cidade">Cidade</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input type="text" class="form-control text-uppercase" id="uf" name="uf" placeholder=" " maxlength="2">
                    <label for="uf">UF</label>
                  </div>
                </div>
              </div>
              <!-- Endereço e Número -->
              <div class="row g-3 mb-3">
                <div class="col-md-9">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="endereco" name="endereco" placeholder=" ">
                    <label for="endereco">Endereço</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="numero" name="numero" placeholder=" ">
                    <label for="numero">Número</label>
                  </div>
                </div>
              </div>
              <!-- Complemento -->
              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="complemento" name="complemento" placeholder=" ">
                <label for="complemento">Complemento</label>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-end mt-4">
            <button type="button" class="btn btn-primary d-flex align-items-center gap-2" id="next-1">
              Próximo <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </div>

        <!-- ETAPA 2: Perfil Social -->
        <div class="section step" id="step-2" style="display:none;">
          <div class="info-card mb-3">
            <i class="fas fa-users me-2"></i>
            Informações sociais relevantes para o processo previdenciário.
          </div>

          <div class="data-block">
            <div class="data-block-header">
              <i class="fas fa-hands-helping text-success"></i>
              Aspectos Sociais
            </div>
            <div class="data-block-body">

              <!-- Situação familiar -->
              <div class="mb-3">
                <label class="form-label fw-bold">Situação familiar</label>
                <div class="row g-2">
                  <div class="col-md-4">
                    <select class="form-select" id="estado_civil">
                      <option value="">Estado civil</option>
                      <option>Solteiro(a)</option>
                      <option>Casado(a)</option>
                      <option>União estável</option>
                      <option>Divorciado(a)</option>
                      <option>Viúvo(a)</option>
                      <option>Separado(a) judicialmente</option>
                    </select>
                  </div>
                  <div class="col-md-4">
                    <select class="form-select" id="dependentes">
                      <option value="">Dependentes</option>
                      <option>Nenhum</option>
                      <option>1 dependente</option>
                      <option>2 dependentes</option>
                      <option>3 dependentes</option>
                      <option>4 dependentes</option>
                      <option>5 ou mais dependentes</option>
                    </select>
                  </div>
                  <div class="col-md-4">
                    <select class="form-select" id="renda_familiar">
                      <option value="">Renda familiar</option>
                      <option>Até 1 salário mínimo</option>
                      <option>1 a 2 salários mínimos</option>
                      <option>2 a 3 salários mínimos</option>
                      <option>3 a 5 salários mínimos</option>
                      <option>Acima de 5 salários mínimos</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Condições de moradia -->
              <div class="mb-3">
                <label class="form-label fw-bold">Condições de moradia</label>
                <div class="row g-2">
                  <div class="col-md-4">
                    <select class="form-select" id="tipo_moradia">
                      <option value="">Tipo de moradia</option>
                      <option>Casa própria</option>
                      <option>Casa alugada</option>
                      <option>Casa cedida</option>
                      <option>Casa financiada</option>
                      <option>Mora com familiares</option>
                      <option>Assentamento</option>
                      <option>Outro</option>
                    </select>
                  </div>
                  <div class="col-md-4">
                    <select class="form-select" id="area_residencia">
                      <option value="">Área de residência</option>
                      <option>Urbana</option>
                      <option>Rural</option>
                      <option>Periférica</option>
                      <option>Comunidade/Favela</option>
                      <option>Assentamento</option>
                    </select>
                  </div>
                  <div class="col-md-4">
                    <select class="form-select" id="infraestrutura">
                      <option value="">Infraestrutura</option>
                      <option>Completa (água, luz, esgoto)</option>
                      <option>Parcial (falta algum serviço)</option>
                      <option>Precária</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Acesso a serviços -->
              <div class="mb-3">
                <label class="form-label fw-bold">Acesso a serviços</label>
                <div class="row g-2">
                  <div class="col-md-6">
                    <div class="checkbox-list">
                      <label><input class="form-check-input" type="checkbox" id="acesso_sus">Utiliza SUS</label>
                      <label><input class="form-check-input" type="checkbox" id="acesso_cras">Acompanhamento CRAS</label>
                      <label><input class="form-check-input" type="checkbox" id="acesso_bpc">Recebe BPC</label>
                      <label><input class="form-check-input" type="checkbox" id="acesso_bolsa_familia">Bolsa Família</label>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="checkbox-list">
                      <label><input class="form-check-input" type="checkbox" id="acesso_aposentadoria">Aposentadoria</label>
                      <label><input class="form-check-input" type="checkbox" id="acesso_outros_beneficios">Outros benefícios</label>
                      <label><input class="form-check-input" type="checkbox" id="acesso_auxilio_emergencial">Auxílio Emergencial</label>
                      <label><input class="form-check-input" type="checkbox" id="acesso_tarifa_social">Tarifa Social</label>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Vulnerabilidades sociais -->
              <div class="mb-3">
                <label class="form-label fw-bold">Vulnerabilidades sociais</label>
                <div class="row g-2">
                  <div class="col-md-6">
                    <div class="checkbox-list">
                      <label><input class="form-check-input" type="checkbox" id="vuln_analfabetismo">Analfabetismo</label>
                      <label><input class="form-check-input" type="checkbox" id="vuln_idoso">Pessoa idosa</label>
                      <label><input class="form-check-input" type="checkbox" id="vuln_deficiencia">Pessoa com deficiência</label>
                      <label><input class="form-check-input" type="checkbox" id="vuln_doenca_cronica">Doença crônica</label>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="checkbox-list">
                      <label><input class="form-check-input" type="checkbox" id="vuln_violencia">Violência doméstica</label>
                      <label><input class="form-check-input" type="checkbox" id="vuln_desemprego">Desemprego prolongado</label>
                      <label><input class="form-check-input" type="checkbox" id="vuln_moradia">Moradia precária</label>
                      <label><input class="form-check-input" type="checkbox" id="vuln_dependencia_quimica">Dependência química</label>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Observações sociais -->
              <div class="mb-3">
                <label class="form-label">Observações sobre condições sociais</label>
                <textarea class="form-control" id="obs_sociais" rows="3" placeholder="Informações complementares sobre a situação social"></textarea>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-between mt-4">
            <button type="button" class="btn btn-secondary" id="back-2">
              <i class="fas fa-arrow-left me-2"></i>Voltar
            </button>
            <button type="button" class="btn btn-primary" id="next-2">
              Próximo<i class="fas fa-arrow-right ms-2"></i>
            </button>
          </div>
        </div>

        <!-- ETAPA 3: Saúde (Reformulada) -->
        <div class="section step" id="step-3" style="display:none;">
          <div class="info-card mb-3">
            <i class="fas fa-heartbeat me-2"></i>
            Informações médicas importantes para o processo previdenciário.
          </div>

          <div class="data-block">
            <div class="data-block-header">
              <i class="fas fa-notes-medical text-danger"></i>
              Condição de Saúde
            </div>
            <div class="data-block-body">
              <!-- Diagnósticos -->
              <div class="mb-3">
                <label class="form-label fw-bold">Diagnósticos</label>
                <div class="row g-2">
                  <div class="col-md-6">
                    <input type="text" class="form-control" id="diagnosticos" placeholder="Descreva os diagnósticos">
                  </div>
                  <div class="col-md-6">
                    <select class="form-select" id="cid">
                      <option value="">Selecione o CID principal</option>
                      <option>A00-B99: Doenças infecciosas</option>
                      <option>C00-D48: Neoplasias</option>
                      <option>E00-E90: Doenças endócrinas</option>
                      <option>F00-F99: Transtornos mentais</option>
                      <option>G00-G99: Doenças do sistema nervoso</option>
                      <option>H00-H59: Doenças do olho</option>
                      <option>H60-H95: Doenças do ouvido</option>
                      <option>I00-I99: Doenças do aparelho circulatório</option>
                      <option>J00-J99: Doenças do aparelho respiratório</option>
                      <option>K00-K93: Doenças do aparelho digestivo</option>
                      <option>L00-L99: Doenças da pele</option>
                      <option>M00-M99: Doenças osteomusculares</option>
                      <option>N00-N99: Doenças do aparelho geniturinário</option>
                      <option>O00-O99: Gravidez, parto e puerpério</option>
                      <option>P00-P96: Afecções perinatais</option>
                      <option>Q00-Q99: Malformações congênitas</option>
                      <option>R00-R99: Sintomas e sinais</option>
                      <option>S00-T98: Lesões e envenenamentos</option>
                      <option>Z00-Z99: Fatores que influenciam o estado de saúde</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Início da doença e tratamento -->
              <div class="row g-3 mb-3">
                <div class="col-md-6">
                  <label class="form-label">Início dos sintomas</label>
                  <div class="row">
                    <div class="col-md-6">
                      <select class="form-select mb-2" id="mes_inicio_doenca">
                        <option value="">Mês</option>
                        <option value="01">Janeiro</option>
                        <option value="02">Fevereiro</option>
                        <option value="03">Março</option>
                        <option value="04">Abril</option>
                        <option value="05">Maio</option>
                        <option value="06">Junho</option>
                        <option value="07">Julho</option>
                        <option value="08">Agosto</option>
                        <option value="09">Setembro</option>
                        <option value="10">Outubro</option>
                        <option value="11">Novembro</option>
                        <option value="12">Dezembro</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <select class="form-select" id="ano_inicio_doenca">
                        <option value="">Ano</option>
                        <!-- Anos serão preenchidos via JS -->
                      </select>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Início do tratamento</label>
                  <div class="row">
                    <div class="col-md-6">
                      <select class="form-select mb-2" id="mes_inicio_tratamento">
                        <option value="">Mês</option>
                        <option value="01">Janeiro</option>
                        <option value="02">Fevereiro</option>
                        <option value="03">Março</option>
                        <option value="04">Abril</option>
                        <option value="05">Maio</option>
                        <option value="06">Junho</option>
                        <option value="07">Julho</option>
                        <option value="08">Agosto</option>
                        <option value="09">Setembro</option>
                        <option value="10">Outubro</option>
                        <option value="11">Novembro</option>
                        <option value="12">Dezembro</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <select class="form-select" id="ano_inicio_tratamento">
                        <option value="">Ano</option>
                        <!-- Anos serão preenchidos via JS -->
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Acompanhamento médico -->
              <div class="row g-3 mb-3">
                <div class="col-md-6">
                  <label class="form-label">Médico assistente</label>
                  <input type="text" class="form-control" id="medico_assistente" placeholder="Nome do(s) médico(s)">
                </div>
                <div class="col-md-6">
                  <label class="form-label">Especialidade</label>
                  <select class="form-select" id="especialidade_medica">
                    <option value="">Selecione a especialidade</option>
                    <option>Clínico Geral</option>
                    <option>Ortopedista</option>
                    <option>Neurologista</option>
                    <option>Psiquiatra</option>
                    <option>Cardiologista</option>
                    <option>Oncologista</option>
                    <option>Reumatologista</option>
                    <option>Endocrinologista</option>
                    <option>Pneumologista</option>
                    <option>Gastroenterologista</option>
                    <option>Nefrologista</option>
                    <option>Urologista</option>
                    <option>Ginecologista</option>
                    <option>Oftalmologista</option>
                    <option>Dermatologista</option>
                    <option>Otorrinolaringologista</option>
                    <option>Geriatra</option>
                    <option>Outro</option>
                  </select>
                </div>
              </div>

              <!-- Impacto na atividade laboral -->
              <div class="mb-3">
                <label class="form-label fw-bold">Impacto na atividade laboral</label>
                <div class="row g-2">
                  <div class="col-md-6">
                    <select class="form-select" id="impacto_laboral">
                      <option value="">Selecione o impacto</option>
                      <option>Incapacidade total e permanente</option>
                      <option>Incapacidade total e temporária</option>
                      <option>Incapacidade parcial e permanente</option>
                      <option>Incapacidade parcial e temporária</option>
                      <option>Redução da capacidade laboral</option>
                      <option>Readaptação necessária</option>
                      <option>Sem impacto significativo</option>
                    </select>
                  </div>
                  <div class="col-md-6">
                    <textarea class="form-control" id="detalhes_impacto" rows="2" placeholder="Detalhes do impacto no trabalho"></textarea>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Documentação Médica -->
          <div class="data-block mt-3">
            <div class="data-block-header">
              <i class="fas fa-file-medical text-info"></i>
              Documentação Médica
            </div>
            <div class="data-block-body">
              <!-- Lista de documentos médicos com checkbox -->
              <div class="mb-3">
                <label class="form-label fw-bold">Documentos médicos apresentados</label>
                <div class="row g-2">
                  <!-- Coluna 1 -->
                  <div class="col-md-4">
                    <div class="form-check doc-card-medical" onclick="toggleCheckbox(this)">
                      <input class="form-check-input" type="checkbox" id="doc_laudo_medico">
                      <label class="form-check-label" for="doc_laudo_medico">Laudo médico</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-check doc-card-medical" onclick="toggleCheckbox(this)">
                      <input class="form-check-input" type="checkbox" id="doc_atestado">
                      <label class="form-check-label" for="doc_atestado">Atestado médico</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-check doc-card-medical" onclick="toggleCheckbox(this)">
                      <input class="form-check-input" type="checkbox" id="doc_receitas">
                      <label class="form-check-label" for="doc_receitas">Receitas médicas</label>
                    </div>
                  </div>

                  <!-- Coluna 2 -->
                  <div class="col-md-4">
                    <div class="form-check doc-card-medical" onclick="toggleCheckbox(this)">
                      <input class="form-check-input" type="checkbox" id="doc_exame_imagem">
                      <label class="form-check-label" for="doc_exame_imagem">Exames de imagem</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-check doc-card-medical" onclick="toggleCheckbox(this)">
                      <input class="form-check-input" type="checkbox" id="doc_exame_sangue">
                      <label class="form-check-label" for="doc_exame_sangue">Exames laboratoriais</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-check doc-card-medical" onclick="toggleCheckbox(this)">
                      <input class="form-check-input" type="checkbox" id="doc_historia_clinica">
                      <label class="form-check-label" for="doc_historia_clinica">História clínica</label>
                    </div>
                  </div>

                  <!-- Coluna 3 -->
                  <div class="col-md-4">
                    <div class="form-check doc-card-medical" onclick="toggleCheckbox(this)">
                      <input class="form-check-input" type="checkbox" id="doc_relatorio_medico">
                      <label class="form-check-label" for="doc_relatorio_medico">Relatório médico</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-check doc-card-medical" onclick="toggleCheckbox(this)">
                      <input class="form-check-input" type="checkbox" id="doc_ficha_hospitalar">
                      <label class="form-check-label" for="doc_ficha_hospitalar">Ficha hospitalar</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-check doc-card-medical" onclick="toggleCheckbox(this)">
                      <input class="form-check-input" type="checkbox" id="doc_guia_pericia">
                      <label class="form-check-label" for="doc_guia_pericia">Guia de perícia</label>
                    </div>
                  </div>

                  <!-- Coluna 4 -->
                  <div class="col-md-4">
                    <div class="form-check doc-card-medical" onclick="toggleCheckbox(this)">
                      <input class="form-check-input" type="checkbox" id="doc_cat">
                      <label class="form-check-label" for="doc_cat">CAT</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-check doc-card-medical" onclick="toggleCheckbox(this)">
                      <input class="form-check-input" type="checkbox" id="doc_prontuario">
                      <label class="form-check-label" for="doc_prontuario">Prontuário médico</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-check doc-card-medical" onclick="toggleCheckbox(this)">
                      <input class="form-check-input" type="checkbox" id="doc_cirurgia">
                      <label class="form-check-label" for="doc_cirurgia">Relatório cirúrgico</label>
                    </div>
                  </div>

                  <!-- Coluna 5 -->
                  <div class="col-md-4">
                    <div class="form-check doc-card-medical" onclick="toggleCheckbox(this)">
                      <input class="form-check-input" type="checkbox" id="doc_fisioterapia">
                      <label class="form-check-label" for="doc_fisioterapia">Relatório fisioterapia</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-check doc-card-medical" onclick="toggleCheckbox(this)">
                      <input class="form-check-input" type="checkbox" id="doc_terapia">
                      <label class="form-check-label" for="doc_terapia">Relatório terapêutico</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-check doc-card-medical" onclick="toggleCheckbox(this)">
                      <input class="form-check-input" type="checkbox" id="doc_resultado_pericia">
                      <label class="form-check-label" for="doc_resultado_pericia">Resultado perícia anterior</label>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Campo para adicionar outro documento médico -->
              <div class="input-group mb-3">
                <input type="text" class="form-control" id="novo_doc_medico" placeholder="Digite outro documento médico">
                <button class="btn btn-info" type="button" onclick="adicionarDocMedico()">
                  <i class="fas fa-plus"></i> Adicionar
                </button>
              </div>

              <!-- Lista dinâmica de documentos médicos adicionais -->
              <div id="docs-medicos-list" class="mb-3">
                <!-- Documentos médicos adicionais serão inseridos aqui -->
              </div>

              <!-- Observações sobre documentação médica -->
              <div class="mb-2">
                <label class="form-label">Observações sobre documentação médica</label>
                <textarea class="form-control" id="obs_documentacao_medica" rows="2" placeholder="Observações relevantes sobre os documentos médicos"></textarea>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-between mt-4">
            <button type="button" class="btn btn-secondary" id="back-3">
              <i class="fas fa-arrow-left me-2"></i>Voltar
            </button>
            <button type="button" class="btn btn-primary" id="next-3">
              Próximo<i class="fas fa-arrow-right ms-2"></i>
            </button>
          </div>
        </div>

        <!-- ETAPA 4: Segurado Especial (Redesenhada conforme solicitação) -->
        <div class="section step" id="step-4" style="display:none;">
          <div class="info-card mb-3">
            <i class="fas fa-user-shield me-2"></i>
            Informações sobre atividades como Segurado Especial para fins previdenciários.
          </div>

          <div class="data-block">
            <div class="data-block-header">
              <i class="fas fa-shield-alt text-success"></i>
              Segurado Especial
            </div>
            <div class="data-block-body">
              <!-- Categorias de Segurado Especial com toggles independentes -->
              <div class="mb-4">
                <label class="form-label fw-bold">Categorias de Segurado Especial</label>
                <p class="text-muted small">Selecione as categorias em que o segurado exerceu atividade</p>

                <!-- Trabalhador Rural -->
                <div class="card mb-3">
                  <div class="card-header bg-light">
                    <div class="form-check form-switch">
                      <input class="form-check-input categoria-segurado" type="checkbox" id="toggle_trabalhador_rural"
                             data-target="campos-trabalhador-rural" onchange="toggleCategoriaSegurado(this)">
                      <label class="form-check-label fw-bold" for="toggle_trabalhador_rural">Trabalhador Rural</label>
                    </div>
                  </div>
                  <div class="card-body" id="campos-trabalhador-rural" style="display:none;">
                    <div class="row g-3 mb-3">
                      <div class="col-md-6">
                        <label class="form-label">Tipo de propriedade</label>
                        <select class="form-select" id="tipo_propriedade_rural">
                          <option value="">Selecione o tipo</option>
                          <option>Própria</option>
                          <option>Arrendada</option>
                          <option>Parceria</option>
                          <option>Comodatário</option>
                          <option>Posseiro</option>
                          <option>Meeiro</option>
                        </select>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Tamanho da propriedade</label>
                        <div class="input-group">
                          <input type="number" class="form-control" id="tamanho_propriedade_rural" min="0" step="0.1" placeholder="Hectares">
                          <span class="input-group-text">ha</span>
                        </div>
                      </div>
                    </div>
                    <div class="row g-3 mb-3">
                      <div class="col-md-6">
                        <label class="form-label">Regime de trabalho</label>
                        <select class="form-select" id="regime_trabalho_rural">
                          <option value="">Selecione o regime</option>
                          <option>Economia Familiar</option>
                          <option>Individual</option>
                          <option>Contratação eventual</option>
                          <option>Empregados permanentes</option>
                        </select>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Produção</label>
                        <select class="form-select" id="producao_rural">
                          <option value="">Selecione o tipo</option>
                          <option>Subsistência</option>
                          <option>Comercialização</option>
                          <option>Mista (subsistência e comercial)</option>
                        </select>
                      </div>
                    </div>

                    <!-- Documentação específica para Trabalhador Rural -->
                    <div class="mt-4 documentacao-categoria">
                      <h6 class="fw-bold"><i class="fas fa-file-alt me-2 text-primary"></i>Documentação para Trabalhador Rural</h6>
                      <ul class="list-group">
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_rural_dap">
                            <label class="form-check-label" for="doc_rural_dap">Declaração de Aptidão ao PRONAF (DAP)</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_rural_itr">
                            <label class="form-check-label" for="doc_rural_itr">Imposto Territorial Rural (ITR)</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_rural_contrato">
                            <label class="form-check-label" for="doc_rural_contrato">Contrato de parceria, arrendamento ou comodato rural</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_rural_notas">
                            <label class="form-check-label" for="doc_rural_notas">Notas de venda da produção rural</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_rural_sindicato">
                            <label class="form-check-label" for="doc_rural_sindicato">Declaração de Sindicato Rural</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_rural_outros">
                            <label class="form-check-label" for="doc_rural_outros">Outros documentos</label>
                            <input type="text" class="form-control mt-2" id="outros_docs_rural" placeholder="Especifique outros documentos">
                          </div>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>

                <!-- Quilombola -->
                <div class="card mb-3">
                  <div class="card-header bg-light">
                    <div class="form-check form-switch">
                      <input class="form-check-input categoria-segurado" type="checkbox" id="toggle_quilombola"
                             data-target="campos-quilombola" onchange="toggleCategoriaSegurado(this)">
                      <label class="form-check-label fw-bold" for="toggle_quilombola">Quilombola</label>
                    </div>
                  </div>
                  <div class="card-body" id="campos-quilombola" style="display:none;">
                    <div class="row g-3 mb-3">
                      <div class="col-md-6">
                        <label class="form-label">Comunidade quilombola</label>
                        <input type="text" class="form-control" id="comunidade_quilombola" placeholder="Nome da comunidade">
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Certificação da Comunidade</label>
                        <select class="form-select" id="certificacao_quilombola">
                          <option value="">Selecione</option>
                          <option value="sim_fundacao_palmares">Sim, pela Fundação Cultural Palmares</option>
                          <option value="sim_incra">Sim, pelo INCRA</option>
                          <option value="em_processo">Em processo de certificação</option>
                          <option value="nao">Não possui certificação</option>
                        </select>
                      </div>
                    </div>
                    <div class="form-check mb-3">
                      <input class="form-check-input" type="checkbox" id="associacao_quilombola">
                      <label class="form-check-label" for="associacao_quilombola">Participa de associação quilombola</label>
                    </div>

                    <!-- Documentação específica para Quilombola -->
                    <div class="mt-4 documentacao-categoria">
                      <h6 class="fw-bold"><i class="fas fa-file-alt me-2 text-primary"></i>Documentação para Quilombola</h6>
                      <ul class="list-group">
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_quilombola_certidao">
                            <label class="form-check-label" for="doc_quilombola_certidao">Certidão de Reconhecimento da Fundação Cultural Palmares</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_quilombola_incra">
                            <label class="form-check-label" for="doc_quilombola_incra">Certificado de Regularização Fundiária do INCRA</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_quilombola_associacao">
                            <label class="form-check-label" for="doc_quilombola_associacao">Declaração da Associação Quilombola</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_quilombola_declaracao">
                            <label class="form-check-label" for="doc_quilombola_declaracao">Declaração de autoridade local</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_quilombola_outros">
                            <label class="form-check-label" for="doc_quilombola_outros">Outros documentos</label>
                            <input type="text" class="form-control mt-2" id="outros_docs_quilombola" placeholder="Especifique outros documentos">
                          </div>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>

                <!-- Pescador Artesanal -->
                <div class="card mb-3">
                  <div class="card-header bg-light">
                    <div class="form-check form-switch">
                      <input class="form-check-input categoria-segurado" type="checkbox" id="toggle_pescador"
                             data-target="campos-pescador" onchange="toggleCategoriaSegurado(this)">
                      <label class="form-check-label fw-bold" for="toggle_pescador">Pescador Artesanal</label>
                    </div>
                  </div>
                  <div class="card-body" id="campos-pescador" style="display:none;">
                    <div class="row g-3 mb-3">
                      <div class="col-md-6">
                        <label class="form-label">Registro de Pescador</label>
                        <input type="text" class="form-control" id="registro_pescador" placeholder="Número do RGP">
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Colônia de Pescadores</label>
                        <input type="text" class="form-control" id="colonia_pescador" placeholder="Nome da colônia">
                      </div>
                    </div>
                    <div class="row g-3">
                      <div class="col-md-6">
                        <label class="form-label">Tipo de Pesca</label>
                        <select class="form-select" id="tipo_pesca">
                          <option value="">Selecione</option>
                          <option>Água doce</option>
                          <option>Água salgada</option>
                          <option>Mista</option>
                        </select>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Possui embarcação própria?</label>
                        <select class="form-select" id="embarcacao_propria">
                          <option value="">Selecione</option>
                          <option value="sim">Sim</option>
                          <option value="nao">Não</option>
                        </select>
                      </div>
                    </div>

                    <!-- Documentação específica para Pescador Artesanal -->
                    <div class="mt-4 documentacao-categoria">
                      <h6 class="fw-bold"><i class="fas fa-file-alt me-2 text-primary"></i>Documentação para Pescador Artesanal</h6>
                      <ul class="list-group">
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_pescador_rgp">
                            <label class="form-check-label" for="doc_pescador_rgp">Registro Geral de Pesca (RGP)</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_pescador_carteira">
                            <label class="form-check-label" for="doc_pescador_carteira">Carteira de pescador profissional</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_pescador_colonia">
                            <label class="form-check-label" for="doc_pescador_colonia">Declaração da Colônia de Pescadores</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_pescador_embarcacao">
                            <label class="form-check-label" for="doc_pescador_embarcacao">Registro de embarcação na Capitania dos Portos</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_pescador_notas">
                            <label class="form-check-label" for="doc_pescador_notas">Notas de venda do pescado</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_pescador_outros">
                            <label class="form-check-label" for="doc_pescador_outros">Outros documentos</label>
                            <input type="text" class="form-control mt-2" id="outros_docs_pescador" placeholder="Especifique outros documentos">
                          </div>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>

                <!-- Indígena -->
                <div class="card mb-3">
                  <div class="card-header bg-light">
                    <div class="form-check form-switch">
                      <input class="form-check-input categoria-segurado" type="checkbox" id="toggle_indigena"
                             data-target="campos-indigena" onchange="toggleCategoriaSegurado(this)">
                      <label class="form-check-label fw-bold" for="toggle_indigena">Indígena</label>
                    </div>
                  </div>
                  <div class="card-body" id="campos-indigena" style="display:none;">
                    <div class="row g-3 mb-3">
                      <div class="col-md-6">
                        <label class="form-label">Etnia</label>
                        <input type="text" class="form-control" id="etnia_indigena" placeholder="Etnia indígena">
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Terra Indígena</label>
                        <input type="text" class="form-control" id="terra_indigena" placeholder="Nome da terra indígena">
                      </div>
                    </div>
                    <div class="form-check mb-3">
                      <input class="form-check-input" type="checkbox" id="registro_funai">
                      <label class="form-check-label" for="registro_funai">Possui registro na FUNAI</label>
                    </div>

                    <!-- Documentação específica para Indígena -->
                    <div class="mt-4 documentacao-categoria">
                      <h6 class="fw-bold"><i class="fas fa-file-alt me-2 text-primary"></i>Documentação para Indígena</h6>
                      <ul class="list-group">
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_indigena_rani">
                            <label class="form-check-label" for="doc_indigena_rani">Registro Administrativo de Nascimento Indígena (RANI)</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_indigena_funai">
                            <label class="form-check-label" for="doc_indigena_funai">Declaração da FUNAI</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_indigena_carteira">
                            <label class="form-check-label" for="doc_indigena_carteira">Carteira de Identidade Indígena</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_indigena_declaracao">
                            <label class="form-check-label" for="doc_indigena_declaracao">Declaração da liderança indígena</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_indigena_outros">
                            <label class="form-check-label" for="doc_indigena_outros">Outros documentos</label>
                            <input type="text" class="form-control mt-2" id="outros_docs_indigena" placeholder="Especifique outros documentos">
                          </div>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>

                <!-- Extrativista -->
                <div class="card mb-3">
                  <div class="card-header bg-light">
                    <div class="form-check form-switch">
                      <input class="form-check-input categoria-segurado" type="checkbox" id="toggle_extrativista"
                             data-target="campos-extrativista" onchange="toggleCategoriaSegurado(this)">
                      <label class="form-check-label fw-bold" for="toggle_extrativista">Extrativista</label>
                    </div>
                  </div>
                  <div class="card-body" id="campos-extrativista" style="display:none;">
                    <div class="row g-3 mb-3">
                      <div class="col-md-6">
                        <label class="form-label">Tipo de Extrativismo</label>
                        <select class="form-select" id="tipo_extrativismo">
                          <option value="">Selecione</option>
                          <option>Vegetal</option>
                          <option>Mineral</option>
                          <option>Animal</option>
                          <option>Misto</option>
                        </select>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Produtos extraídos</label>
                        <input type="text" class="form-control" id="produtos_extraidos" placeholder="Produtos extraídos">
                      </div>
                    </div>
                    <div class="form-check mb-3">
                      <input class="form-check-input" type="checkbox" id="reserva_extrativista">
                      <label class="form-check-label" for="reserva_extrativista">Pertence a Reserva Extrativista (RESEX)</label>
                    </div>

                    <!-- Documentação específica para Extrativista -->
                    <div class="mt-4 documentacao-categoria">
                      <h6 class="fw-bold"><i class="fas fa-file-alt me-2 text-primary"></i>Documentação para Extrativista</h6>
                      <ul class="list-group">
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_extrativista_resex">
                            <label class="form-check-label" for="doc_extrativista_resex">Declaração de residência em RESEX</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_extrativista_associacao">
                            <label class="form-check-label" for="doc_extrativista_associacao">Declaração da associação de extrativistas</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_extrativista_comercializacao">
                            <label class="form-check-label" for="doc_extrativista_comercializacao">Comprovantes de comercialização dos produtos</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_extrativista_icmbio">
                            <label class="form-check-label" for="doc_extrativista_icmbio">Declaração do ICMBio</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_extrativista_outros">
                            <label class="form-check-label" for="doc_extrativista_outros">Outros documentos</label>
                            <input type="text" class="form-control mt-2" id="outros_docs_extrativista" placeholder="Especifique outros documentos">
                          </div>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>

                <!-- Seringueiro -->
                <div class="card mb-3">
                  <div class="card-header bg-light">
                    <div class="form-check form-switch">
                      <input class="form-check-input categoria-segurado" type="checkbox" id="toggle_seringueiro"
                             data-target="campos-seringueiro" onchange="toggleCategoriaSegurado(this)">
                      <label class="form-check-label fw-bold" for="toggle_seringueiro">Seringueiro</label>
                    </div>
                  </div>
                  <div class="card-body" id="campos-seringueiro" style="display:none;">
                    <div class="row g-3 mb-3">
                      <div class="col-md-6">
                        <label class="form-label">Região de atuação</label>
                        <input type="text" class="form-control" id="regiao_seringueiro" placeholder="Região onde atua">
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Associação/Cooperativa</label>
                        <input type="text" class="form-control" id="associacao_seringueiro" placeholder="Nome da associação ou cooperativa">
                      </div>
                    </div>
                    <div class="row g-3">
                      <div class="col-md-12">
                        <label class="form-label">Detalhes da atividade</label>
                        <textarea class="form-control" id="detalhes_seringueiro" rows="2" placeholder="Informe detalhes sobre como exerce a atividade"></textarea>
                      </div>
                    </div>

                    <!-- Documentação específica para Seringueiro -->
                    <div class="mt-4 documentacao-categoria">
                      <h6 class="fw-bold"><i class="fas fa-file-alt me-2 text-primary"></i>Documentação para Seringueiro</h6>
                      <ul class="list-group">
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_seringueiro_carteira">
                            <label class="form-check-label" for="doc_seringueiro_carteira">Carteira de seringueiro</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_seringueiro_associacao">
                            <label class="form-check-label" for="doc_seringueiro_associacao">Declaração da associação ou cooperativa</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_seringueiro_comercializacao">
                            <label class="form-check-label" for="doc_seringueiro_comercializacao">Comprovantes de venda do látex</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_seringueiro_autoridade">
                            <label class="form-check-label" for="doc_seringueiro_autoridade">Declaração de autoridade local</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_seringueiro_outros">
                            <label class="form-check-label" for="doc_seringueiro_outros">Outros documentos</label>
                            <input type="text" class="form-control mt-2" id="outros_docs_seringueiro" placeholder="Especifique outros documentos">
                          </div>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>

                <!-- Marisqueiro -->
                <div class="card mb-3">
                  <div class="card-header bg-light">
                    <div class="form-check form-switch">
                      <input class="form-check-input categoria-segurado" type="checkbox" id="toggle_marisqueiro"
                             data-target="campos-marisqueiro" onchange="toggleCategoriaSegurado(this)">
                      <label class="form-check-label fw-bold" for="toggle_marisqueiro">Marisqueiro</label>
                    </div>
                  </div>
                  <div class="card-body" id="campos-marisqueiro" style="display:none;">
                    <div class="row g-3 mb-3">
                      <div class="col-md-6">
                        <label class="form-label">Local de coleta</label>
                        <input type="text" class="form-control" id="local_marisqueiro" placeholder="Região onde realiza a coleta">
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Tipos de mariscos</label>
                        <input type="text" class="form-control" id="tipos_mariscos" placeholder="Tipos de mariscos coletados">
                      </div>
                    </div>
                    <div class="row g-3">
                      <div class="col-md-6">
                        <label class="form-label">Associação/Colônia</label>
                        <input type="text" class="form-control" id="associacao_marisqueiro" placeholder="Nome da associação ou colônia">
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Forma de comercialização</label>
                        <select class="form-select" id="comercializacao_marisqueiro">
                          <option value="">Selecione</option>
                          <option>Venda direta</option>
                          <option>Atravessador</option>
                          <option>Cooperativa</option>
                          <option>Subsistência</option>
                          <option>Mista</option>
                        </select>
                      </div>
                    </div>

                    <!-- Documentação específica para Marisqueiro -->
                    <div class="mt-4 documentacao-categoria">
                      <h6 class="fw-bold"><i class="fas fa-file-alt me-2 text-primary"></i>Documentação para Marisqueiro</h6>
                      <ul class="list-group">
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_marisqueiro_rgp">
                            <label class="form-check-label" for="doc_marisqueiro_rgp">Registro Geral de Pesca (RGP) ou Registro de Marisqueiros</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_marisqueiro_colonia">
                            <label class="form-check-label" for="doc_marisqueiro_colonia">Declaração da Colônia ou Associação</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_marisqueiro_notas">
                            <label class="form-check-label" for="doc_marisqueiro_notas">Notas de venda dos mariscos</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_marisqueiro_autoridade">
                            <label class="form-check-label" for="doc_marisqueiro_autoridade">Declaração de autoridade local</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_marisqueiro_outros">
                            <label class="form-check-label" for="doc_marisqueiro_outros">Outros documentos</label>
                            <input type="text" class="form-control mt-2" id="outros_docs_marisqueiro" placeholder="Especifique outros documentos">
                          </div>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>

                <!-- Ribeirinho -->
                <div class="card mb-3">
                  <div class="card-header bg-light">
                    <div class="form-check form-switch">
                      <input class="form-check-input categoria-segurado" type="checkbox" id="toggle_ribeirinho"
                             data-target="campos-ribeirinho" onchange="toggleCategoriaSegurado(this)">
                      <label class="form-check-label fw-bold" for="toggle_ribeirinho">Ribeirinho</label>
                    </div>
                  </div>
                  <div class="card-body" id="campos-ribeirinho" style="display:none;">
                    <div class="row g-3 mb-3">
                      <div class="col-md-6">
                        <label class="form-label">Rio/Bacia</label>
                        <input type="text" class="form-control" id="rio_ribeirinho" placeholder="Nome do rio ou bacia hidrográfica">
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Comunidade</label>
                        <input type="text" class="form-control" id="comunidade_ribeirinho" placeholder="Nome da comunidade ribeirinha">
                      </div>
                    </div>
                    <div class="row g-3 mb-3">
                      <div class="col-md-6">
                        <label class="form-label">Atividades principais</label>
                        <select class="form-select" id="atividades_ribeirinho" multiple>
                          <option>Pesca</option>
                          <option>Agricultura de várzea</option>
                          <option>Extrativismo</option>
                          <option>Caça</option>
                          <option>Artesanato</option>
                          <option>Criação de pequenos animais</option>
                        </select>
                        <small class="form-text text-muted">Segure Ctrl para selecionar múltiplas opções</small>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Detalhes da atividade</label>
                        <textarea class="form-control" id="detalhes_ribeirinho" rows="3" placeholder="Informe detalhes sobre como exerce as atividades"></textarea>
                      </div>
                    </div>

                    <!-- Documentação específica para Ribeirinho -->
                    <div class="mt-4 documentacao-categoria">
                      <h6 class="fw-bold"><i class="fas fa-file-alt me-2 text-primary"></i>Documentação para Ribeirinho</h6>
                      <ul class="list-group">
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_ribeirinho_residencia">
                            <label class="form-check-label" for="doc_ribeirinho_residencia">Comprovante de residência em comunidade ribeirinha</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_ribeirinho_associacao">
                            <label class="form-check-label" for="doc_ribeirinho_associacao">Declaração da associação de moradores</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_ribeirinho_pesca">
                            <label class="form-check-label" for="doc_ribeirinho_pesca">Registro de pescador (se for o caso)</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_ribeirinho_autoridade">
                            <label class="form-check-label" for="doc_ribeirinho_autoridade">Declaração de autoridade local</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_ribeirinho_producao">
                            <label class="form-check-label" for="doc_ribeirinho_producao">Comprovantes de comercialização da produção</label>
                          </div>
                        </li>
                        <li class="list-group-item">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="doc_ribeirinho_outros">
                            <label class="form-check-label" for="doc_ribeirinho_outros">Outros documentos</label>
                            <input type="text" class="form-control mt-2" id="outros_docs_ribeirinho" placeholder="Especifique outros documentos">
                          </div>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>

                <!-- Período como Segurado Especial -->
                <div class="card mt-4">
                  <div class="card-header bg-light">
                    <span class="fw-bold">Período como Segurado Especial</span>
                  </div>
                  <div class="card-body">
                    <div class="row g-3">
                      <div class="col-md-5">
                        <label class="form-label">De:</label>
                        <div class="d-flex flex-column">
                          <select class="form-select mb-2" id="mes_inicio_segurado">
                            <option value="">Selecione o mês</option>
                            <option value="01">Janeiro</option>
                            <option value="02">Fevereiro</option>
                            <option value="03">Março</option>
                            <option value="04">Abril</option>
                            <option value="05">Maio</option>
                            <option value="06">Junho</option>
                            <option value="07">Julho</option>
                            <option value="08">Agosto</option>
                            <option value="09">Setembro</option>
                            <option value="10">Outubro</option>
                            <option value="11">Novembro</option>
                            <option value="12">Dezembro</option>
                          </select>
                          <select class="form-select" id="ano_inicio_segurado">
                            <option value="">Selecione o ano</option>
                            <!-- Anos serão preenchidos via JS -->
                          </select>
                        </div>
                      </div>

                      <div class="col-md-5">
                        <label class="form-label">Até:</label>
                        <div class="d-flex flex-column">
                          <select class="form-select mb-2" id="mes_fim_segurado">
                            <option value="">Selecione o mês</option>
                            <option value="01">Janeiro</option>
                            <option value="02">Fevereiro</option>
                            <option value="03">Março</option>
                            <option value="04">Abril</option>
                            <option value="05">Maio</option>
                            <option value="06">Junho</option>
                            <option value="07">Julho</option>
                            <option value="08">Agosto</option>
                            <option value="09">Setembro</option>
                            <option value="10">Outubro</option>
                            <option value="11">Novembro</option>
                            <option value="12">Dezembro</option>
                          </select>
                          <select class="form-select" id="ano_fim_segurado">
                            <option value="">Selecione o ano</option>
                            <!-- Anos serão preenchidos via JS -->
                          </select>
                        </div>
                      </div>

                      <div class="col-md-2 d-flex align-items-end">
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="segurado_ate_hoje" onchange="atualizaFimSegurado(this)">
                          <label class="form-check-label" for="segurado_ate_hoje">Até hoje</label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Documentação de Segurado Especial -->
          <div class="data-block mt-3" id="documentacao-segurado-block">
            <div class="data-block-header">
              <i class="fas fa-file-alt text-primary"></i>
              Documentação de Segurado Especial
            </div>
            <div class="data-block-body">
              <!-- Lista completa de documentos em formato de grid com cards clicáveis -->
              <div class="row g-2" id="docs-grid">
                <!-- Coluna 1 -->
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_incra">
                    <label class="form-check-label" for="doc_incra">CCIR/INCRA</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_itr">
                    <label class="form-check-label" for="doc_itr">ITR</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_contrato_rural">
                    <label class="form-check-label" for="doc_contrato_rural">Contrato arrendamento/parceria</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_matricula">
                    <label class="form-check-label" for="doc_matricula">Matrícula imóvel rural</label>
                  </div>
                </div>

                <!-- Coluna 2 -->
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_residencia">
                    <label class="form-check-label" for="doc_residencia">Comprovante residência rural</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_notas_venda">
                    <label class="form-check-label" for="doc_notas_venda">Notas fiscais de venda</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_notas_compra">
                    <label class="form-check-label" for="doc_notas_compra">Notas fiscais de compra insumos</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_dap">
                    <label class="form-check-label" for="doc_dap">DAP/CAF</label>
                  </div>
                </div>

                <!-- Coluna 3 -->
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_sindicato_dec">
                    <label class="form-check-label" for="doc_sindicato_dec">Declaração sindicato rural</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_sindicato_card">
                    <label class="form-check-label" for="doc_sindicato_card">Carteira sindicato rural</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_rgp">
                    <label class="form-check-label" for="doc_rgp">Registro Geral de Pesca (RGP)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_certidao">
                    <label class="form-check-label" for="doc_certidao">Certidão civil rural</label>
                  </div>
                </div>

                <!-- Coluna 4 -->
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_titulo">
                    <label class="form-check-label" for="doc_titulo">Título eleitor rural</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_registro_funai">
                    <label class="form-check-label" for="doc_registro_funai">Registro FUNAI</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_registro_palmares">
                    <label class="form-check-label" for="doc_registro_palmares">Certificação Quilombola</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_ficha_saude">
                    <label class="form-check-label" for="doc_ficha_saude">Ficha posto saúde rural</label>
                  </div>
                </div>

                <!-- Coluna 5 -->
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_matricula_escolar">
                    <label class="form-check-label" for="doc_matricula_escolar">Matrícula escolar rural</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_inben_rural">
                    <label class="form-check-label" for="doc_inben_rural">INFBEN cônjuge rural</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_sentenca">
                    <label class="form-check-label" for="doc_sentenca">Sentença processo anterior</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_declaracao_vizinhos">
                    <label class="form-check-label" for="doc_declaracao_vizinhos">Declaração vizinhos</label>
                  </div>
                </div>

                <!-- Coluna 6 -->
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_contrato_parceria">
                    <label class="form-check-label" for="doc_contrato_parceria">Contrato de parceria</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_recibos_venda">
                    <label class="form-check-label" for="doc_recibos_venda">Recibos venda produção</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_associacao_pescadores">
                    <label class="form-check-label" for="doc_associacao_pescadores">Registro colônia de pescadores</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_cooperativa">
                    <label class="form-check-label" for="doc_cooperativa">Cooperativa rural</label>
                  </div>
                </div>
              </div>

              <!-- Campo para adicionar outro documento -->
              <div class="input-group mt-3 mb-2">
                <input type="text" class="form-control" id="novo_doc_segurado" placeholder="Digite outro documento de segurado especial">
                <button class="btn btn-success" type="button" onclick="adicionarDocSegurado()">
                  <i class="fas fa-plus"></i> Adicionar
                </button>
              </div>

              <!-- Lista dinâmica de documentos adicionais -->
              <div id="docs-adicionais-list">
                <!-- Documentos adicionais serão inseridos aqui -->
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-between mt-4">
            <button type="button" class="btn btn-secondary" id="back-4">
              <i class="fas fa-arrow-left me-2"></i>Voltar
            </button>
            <button type="button" class="btn btn-primary" id="next-4">
              Próximo<i class="fas fa-arrow-right ms-2"></i>
            </button>
          </div>
        </div>

        <!-- ETAPA 5: Histórico de Atividades Profissionais -->
        <div class="section step" id="step-5" style="display:none;">
          <div class="info-card mb-4">
            <i class="fas fa-briefcase me-2"></i>
            Registre o histórico profissional completo, incluindo vínculos formais e informais.
          </div>

          <div class="data-block">
            <div class="data-block-header">
              <i class="fas fa-history text-primary"></i>
              Histórico de Atividades Profissionais
            </div>
            <div class="data-block-body">
              <div id="vinculos-list" class="dynamic-list mb-3">
                <!-- Vínculos serão adicionados aqui dinamicamente -->
              </div>

              <button type="button" class="add-btn" onclick="addVinculo()">
                <i class="fas fa-plus-circle me-2"></i> Adicionar Vínculo
              </button>

              <!-- Informações adicionais sobre histórico de trabalho -->
              <div class="mt-4 p-3 bg-light rounded border">
                <h5 class="mb-3 text-primary"><i class="fas fa-info-circle me-2"></i>Informações Complementares</h5>

                <div class="row g-3">
                  <div class="col-md-6">
                    <div class="form-floating">
                      <textarea class="form-control" id="gaps_trabalho" name="gaps_trabalho" style="height: 100px" placeholder=" "></textarea>
                      <label for="gaps_trabalho">Períodos sem registro (gaps)</label>
                    </div>
                    <small class="text-muted mt-1">Indique os períodos sem atividade formal e o motivo</small>
                  </div>
                  <div class="col-md-6">
                    <div class="form-floating">
                      <textarea class="form-control" id="outras_atividades" name="outras_atividades" style="height: 100px" placeholder=" "></textarea>
                      <label for="outras_atividades">Outras atividades não registradas</label>
                    </div>
                    <small class="text-muted mt-1">Descreva outras atividades informais realizadas</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Seção de contribuições previdenciárias -->
          <div class="data-block mt-4">
            <div class="data-block-header">
              <i class="fas fa-file-invoice-dollar text-primary"></i>
              Contribuições Previdenciárias
            </div>
            <div class="data-block-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-floating">
                    <select class="form-select" id="cnis_atualizado" name="cnis_atualizado">
                      <option value="" selected disabled>Selecione...</option>
                      <option value="sim">Sim</option>
                      <option value="nao">Não</option>
                    </select>
                    <label for="cnis_atualizado">Possui CNIS atualizado?</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="numero_inscricao" name="numero_inscricao" placeholder=" ">
                    <label for="numero_inscricao">Número NIT/PIS/PASEP</label>
                  </div>
                </div>
              </div>

              <div class="mt-3">
                <div class="form-floating">
                  <textarea class="form-control" id="contribuicoes_autonomas" name="contribuicoes_autonomas" style="height: 80px" placeholder=" "></textarea>
                  <label for="contribuicoes_autonomas">Contribuições como autônomo/facultativo</label>
                </div>
                <small class="text-muted">Informe períodos e valores de contribuição como autônomo ou facultativo, se houver</small>
              </div>
            </div>
          </div>

          <div class="step-navigation mt-4">
            <button type="button" class="btn btn-secondary d-flex align-items-center gap-2" id="back-5">
              <i class="fas fa-arrow-left"></i> Voltar
            </button>
            <button type="button" class="btn btn-primary d-flex align-items-center gap-2" id="next-5">
              Próximo <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </div>

        <!-- ETAPA 6: Documentos e Conclusão (Reformulada) -->
        <div class="section step" id="step-6" style="display:none;">
          <div class="info-card mb-3">
            <i class="fas fa-file-alt me-2"></i>
            Documentação completa e conclusão do atendimento previdenciário.
          </div>

          <div class="data-block">
            <div class="data-block-header">
              <i class="fas fa-tasks text-primary"></i>
              Checklist de Documentos
            </div>
            <div class="data-block-body">
              <!-- Lista organizada de documentos em colunas -->
              <div class="row g-2 mb-3">
                <div class="col-md-4">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_identidade">
                    <label class="form-check-label fw-bold" for="doc_identidade">Identidade (RG)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_cpf">
                    <label class="form-check-label fw-bold" for="doc_cpf">CPF</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_ctps">
                    <label class="form-check-label fw-bold" for="doc_ctps">Carteira de Trabalho (CTPS)</label>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_certidoes">
                    <label class="form-check-label" for="doc_certidoes">Certidões (casamento, nascimento)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_laudos">
                    <label class="form-check-label" for="doc_laudos">Laudos médicos/exames</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_cnis">
                    <label class="form-check-label" for="doc_cnis">CNIS atualizado</label>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_rurais">
                    <label class="form-check-label" for="doc_rurais">Documentos rurais</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_comprovante_end">
                    <label class="form-check-label" for="doc_comprovante_end">Comprovante de endereço</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-check doc-card" onclick="toggleCheckbox(this)">
                    <input class="form-check-input" type="checkbox" id="doc_procuracao">
                    <label class="form-check-label" for="doc_procuracao">Procuração/Contrato</label>
                  </div>
                </div>
              </div>

              <!-- Outros documentos dinâmicos -->
              <div id="outros-documentos-list" class="mb-3">
                <!-- Aqui serão adicionados outros documentos -->
              </div>

              <!-- Campo para adicionar outro documento -->
              <div class="input-group mb-3">
                <input type="text" class="form-control" id="novo_doc_geral" placeholder="Digite outro documento necessário">
                <button class="btn btn-success" type="button" onclick="adicionarOutroDocumento()">
                  <i class="fas fa-plus"></i> Adicionar
                </button>
              </div>

              <!-- Script para adicionar documento com botão de remover -->
              <script>
                function adicionarOutroDocumento() {
                  const novoDoc = document.getElementById('novo_doc_geral').value.trim();

                  if (novoDoc) {
                    const docList = document.getElementById('outros-documentos-list');
                    const novoItem = document.createElement('div');
                    novoItem.className = 'alert alert-light d-flex align-items-center justify-content-between p-2 mb-2 border';

                    // HTML do novo documento com botão de remover
                    novoItem.innerHTML = `
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="doc_custom_${Date.now()}">
                        <label class="form-check-label">
                          ${novoDoc}
                        </label>
                      </div>
                      <button type="button" class="btn btn-sm btn-outline-danger" onclick="this.closest('.alert').remove()">
                        <i class="fas fa-times"></i>
                      </button>
                    `;

                    // Adicionar ao container
                    docList.appendChild(novoItem);

                    // Limpar campo
                    document.getElementById('novo_doc_geral').value = '';
                  }
                }
              </script>
            </div>
          </div>

          <div class="data-block mt-4">
            <div class="data-block-header">
              <i class="fas fa-flag-checkered text-success"></i>
              Conclusão e Próximos Passos
            </div>
            <div class="data-block-body">
              <!-- Possíveis benefícios -->
              <div class="mb-3">
                <label class="form-label fw-bold">Possíveis benefícios identificados:</label>
                <div class="row g-2">
                  <div class="col-md-6">
                    <div class="checkbox-list">
                      <label><input class="form-check-input" type="checkbox" id="ben_aposentadoria_idade">Aposentadoria por idade</label>
                      <label><input class="form-check-input" type="checkbox" id="ben_aposentadoria_tempo">Aposentadoria por tempo</label>
                      <label><input class="form-check-input" type="checkbox" id="ben_aposentadoria_invalidez">Aposentadoria por invalidez</label>
                      <label><input class="form-check-input" type="checkbox" id="ben_auxilio_doenca">Auxílio-doença</label>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="checkbox-list">
                      <label><input class="form-check-input" type="checkbox" id="ben_bpc">BPC/LOAS</label>
                      <label><input class="form-check-input" type="checkbox" id="ben_pensao">Pensão por morte</label>
                      <label><input class="form-check-input" type="checkbox" id="ben_salario_maternidade">Salário-maternidade</label>
                      <label><input class="form-check-input" type="checkbox" id="ben_auxilio_acidente">Auxílio-acidente</label>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Encaminhamentos e observações -->
              <div class="mb-3">
                <label class="form-label fw-bold">Encaminhamentos e observações finais:</label>
                <textarea class="form-control" id="observacoes_finais" rows="4" placeholder="Observações relevantes e próximos passos"></textarea>
              </div>

              <!-- Data e responsável -->
              <div class="row g-3 mb-3">
                <div class="col-md-4">
                  <label class="form-label">Data do atendimento:</label>
                  <input type="text" class="form-control" id="data_atendimento" value="18/04/2025">
                </div>
                <div class="col-md-8">
                  <label class="form-label">Advogado/Responsável:</label>
                  <input type="text" class="form-control" id="advogado" placeholder="Nome do advogado responsável">
                </div>
              </div>

              <!-- Assinatura -->
              <div class="mb-3">
                <label class="form-label">Assinatura do cliente:</label>
                <input type="text" class="form-control" id="assinatura_cliente" placeholder="Campo para assinatura física ou digital">
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-between mt-4">
            <button type="button" class="btn btn-secondary d-flex align-items-center gap-2" id="back-6">
              <i class="fas fa-arrow-left"></i> Voltar
            </button>
            <button type="button" class="btn btn-primary d-flex align-items-center gap-2" onclick="window.print()">
              <i class="fas fa-print"></i> Imprimir Ficha
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Multi-step navigation
    const steps = Array.from(document.querySelectorAll('.step'));
    let currentStep = 0;

    function showStep(idx) {
      steps.forEach((el, i) => el.style.display = i === idx ? '' : 'none');
      currentStep = idx;

      // Atualiza o indicador de progresso
      document.querySelectorAll('.progress-step').forEach((el, i) => {
        if (i === idx) {
          el.classList.add('active');
        } else {
          el.classList.remove('active');
        }
      });

      // Atualiza os ícones de navegação
      updateStepMapActive(idx);
    }

    document.addEventListener('DOMContentLoaded', function() {
      console.log("DOM carregado, inicializando formulário...");

      // Mostra a primeira etapa ao carregar a página
      showStep(0);

      // Configuração dos botões de navegação
      document.getElementById('next-1')?.addEventListener('click', () => showStep(1));
      document.getElementById('back-2')?.addEventListener('click', () => showStep(0));
      document.getElementById('next-2')?.addEventListener('click', () => showStep(2));
      document.getElementById('back-3')?.addEventListener('click', () => showStep(1));
      document.getElementById('next-3')?.addEventListener('click', () => showStep(3));
      document.getElementById('back-4')?.addEventListener('click', () => showStep(2));
      document.getElementById('next-4')?.addEventListener('click', () => showStep(4));
      document.getElementById('back-5')?.addEventListener('click', () => showStep(3));
      document.getElementById('next-5')?.addEventListener('click', () => showStep(5));
      document.getElementById('back-6')?.addEventListener('click', () => showStep(4));
      document.getElementById('next-6')?.addEventListener('click', () => showStep(6));

      // Adicionar eventos de clique aos links de navegação
      document.querySelectorAll('.step-link').forEach(function(link) {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const step = parseInt(this.getAttribute('data-step')) - 1;
          showStep(step);
        });
      });
    });

    // Inicialização do Flatpickr (calendário)
    document.addEventListener('DOMContentLoaded', function() {
      console.log("DOM carregado, iniciando preenchimento de seletores...");
      inicializarTodosSeletoresAnos();

      // Configuração para campos de data com formato brasileiro
      const dateConfig = {
        dateFormat: "d/m/Y",
        locale: "pt",
        allowInput: true,
        disableMobile: true
      };

      // Inicializa o campo de data de nascimento
      flatpickr("#nascimento", {
        ...dateConfig,
        yearRange: "1920:2010",
        onChange: function(selectedDates, dateStr, instance) {
          if (selectedDates.length > 0) {
            const birthDate = selectedDates[0];
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();

            // Ajusta a idade se o aniversário ainda não ocorreu este ano
            if (today.getMonth() < birthDate.getMonth() ||
                (today.getMonth() === birthDate.getMonth() && today.getDate() < birthDate.getDate())) {
              age--;
            }

            // Obtém o elemento de input
            const input = document.getElementById('nascimento');

            // Define o valor do input para incluir a idade
            input.value = dateStr + "   (" + age + " anos)";

            // Aplica estilo para alinhar o texto no input
            input.style.textAlign = "left";

            // Posiciona o cursor no início do input para não mostrar o final automaticamente
            if (document.activeElement === input) {
              setTimeout(() => {
                input.selectionStart = 0;
                input.selectionEnd = 0;
              }, 0);
            }
          }
        }
      });

      // Inicializa outros campos de data que possam existir no formulário
      document.querySelectorAll('input[type="date"]').forEach(input => {
        flatpickr(input, dateConfig);
      });

      // Inicializa qualquer outro campo que precise do calendário
      if (document.querySelector('input[name="data_atendimento"]')) {
        flatpickr('input[name="data_atendimento"]', {
          ...dateConfig,
          defaultDate: "today"
        });
      }

      // Inicializa o campo de período rural com seletor de mês/ano
      flatpickr("#periodo_rural", {
        plugins: [new monthSelectPlugin({ shorthand: true, dateFormat: "m/Y", altFormat: "F Y" })],
        locale: "pt",
        allowInput: true
      });

      // Verificar e aplicar máscaras para os campos iniciais
      const cpfInput = document.getElementById('cpf');
      if (cpfInput) {
        cpfInput.addEventListener('input', function() {
          maskCPF(this);
        });
      }

      const telefoneInput = document.getElementById('telefone');
      if (telefoneInput) {
        telefoneInput.addEventListener('input', function() {
          maskPhone(this);
        });
      }

      const cepInput = document.getElementById('cep');
      if (cepInput) {
        cepInput.addEventListener('input', function() {
          maskCEP(this);
        });

        // Configurar autopreenchimento a partir do CEP
        cepInput.addEventListener('blur', function() {
          const cep = this.value.replace(/\D/g, '');
          if (cep.length === 8) {
            consultarCEP(cep);
          }
        });
      }
    });

    // Funções de máscara para CPF e outros campos
    function maskCPF(input) {
      let value = input.value.replace(/\D/g, '');
      if (value.length > 11) value = value.slice(0, 11);

      if (value.length > 9) {
        value = value.replace(/^(\d{3})(\d{3})(\d{3})(\d{1,2})$/, "$1.$2.$3-$4");
      } else if (value.length > 6) {
        value = value.replace(/^(\d{3})(\d{3})(\d{1,})$/, "$1.$2.$3");
      } else if (value.length > 3) {
        value = value.replace(/^(\d{3})(\d{1,})$/, "$1.$2");
      }

      input.value = value;
    }

    function maskPhone(input) {
      let value = input.value.replace(/\D/g, '');
      if (value.length > 11) value = value.slice(0, 11);

      if (value.length > 10) {
        value = value.replace(/^(\d{2})(\d{5})(\d{4})$/, "($1) $2-$3");
      } else if (value.length > 6) {
        value = value.replace(/^(\d{2})(\d{4})(\d{1,4})$/, "($1) $2-$3");
      } else if (value.length > 2) {
        value = value.replace(/^(\d{2})(\d{1,})$/, "($1) $2");
      }

      input.value = value;
    }

    function maskCEP(input) {
      let value = input.value.replace(/\D/g, '');
      if (value.length > 8) value = value.slice(0, 8);

      if (value.length > 5) {
        value = value.replace(/^(\d{5})(\d{1,3})$/, "$1-$2");
      }

      input.value = value;
    }

    // Função para calcular idade com base na data de nascimento
    function calcularIdade(dataNascimento) {
      const hoje = new Date();
      const nascimento = new Date(dataNascimento);

      let idade = hoje.getFullYear() - nascimento.getFullYear();

      // Ajusta a idade se o aniversário ainda não ocorreu este ano
      if (hoje.getMonth() < nascimento.getMonth() ||
          (hoje.getMonth() === nascimento.getMonth() && hoje.getDate() < nascimento.getDate())) {
        idade--;
      }

      return idade;
    }

    // Função de máscara para data de nascimento com cálculo de idade
    function maskDate(input) {
      let value = input.value.replace(/\D/g, '');
      if (value.length > 8) value = value.slice(0, 8);

      if (value.length > 4) {
        value = value.replace(/^(\d{2})(\d{2})(\d{1,4})$/, "$1/$2/$3");
      } else if (value.length > 2) {
        value = value.replace(/^(\d{2})(\d{1,2})$/, "$1/$2");
      }

      // Aplicar a máscara ao input
      input.value = value;

      // Calcular idade se a data estiver completa (8 dígitos)
      if (value.length === 8) {
        const dia = parseInt(value.substring(0, 2));
        const mes = parseInt(value.substring(2, 4)) - 1; // Mês em JS começa de 0
        const ano = parseInt(value.substring(4, 8));

        if (!isNaN(dia) && !isNaN(mes) && !isNaN(ano)) {
          const dataNascimento = new Date(ano, mes, dia);
          const idade = calcularIdade(dataNascimento);

          // Verificar se a idade é válida (entre 0 e 120 anos)
          if (idade >= 0 && idade < 120) {
            // Formatar a data e adicionar a idade
            input.value = `${dia.toString().padStart(2, '0')}/${(mes+1).toString().padStart(2, '0')}/${ano}   (${idade} anos)`;
          }
        }
      }
    }

    // Função para calcular idade automaticamente quando a data de nascimento é inserida
    function calcularIdadeAutomatica() {
      const nascimentoInput = document.getElementById('nascimento');
      const idadeInput = document.getElementById('idade');

      if (!nascimentoInput.value) return;

      // Extrai a data do campo (assume formato DD/MM/YYYY)
      let dataNascimento = nascimentoInput.value;
      // Remove a parte da idade entre parênteses, se existir
      dataNascimento = dataNascimento.split('(')[0].trim();

      const parts = dataNascimento.split('/');
      if (parts.length !== 3) return;

      const dia = parseInt(parts[0], 10);
      const mes = parseInt(parts[1], 10) - 1; // Mês é base 0 em JS
      const ano = parseInt(parts[2], 10);

      if (isNaN(dia) || isNaN(mes) || isNaN(ano)) return;

      const dataNasc = new Date(ano, mes, dia);
      const hoje = new Date();

      let idade = hoje.getFullYear() - dataNasc.getFullYear();

      // Ajusta a idade se o aniversário ainda não ocorreu este ano
      if (hoje.getMonth() < dataNasc.getMonth() ||
          (hoje.getMonth() === dataNasc.getMonth() && hoje.getDate() < dataNasc.getDate())) {
        idade--;
      }

      // Preencher o campo de idade se for um valor razoável
      if (idade >= 0 && idade < 120) {
        idadeInput.value = idade;
      }
    }

    // Consultar CEP e preencher campos automaticamente
    function consultarCEP(cep) {
      // Mostrar indicador de carregamento
      const cepInput = document.getElementById('cep');
      if (cepInput) {
        cepInput.classList.add('is-loading');
      }

      // Limpar campos antes de consultar
      const camposEndereco = ['endereco', 'bairro', 'cidade', 'uf'];
      camposEndereco.forEach(campo => {
        const el = document.getElementById(campo);
        if (el) el.value = '';
      });

      fetch(`https://viacep.com.br/ws/${cep}/json/`)
        .then(response => {
          if (!response.ok) {
            throw new Error('Falha na consulta do CEP');
          }
          return response.json();
        })
        .then(data => {
          if (data.erro) {
            alert('CEP não encontrado');
            return;
          }

          // Preencher os campos com os dados retornados
          if (document.getElementById('endereco')) {
            document.getElementById('endereco').value = data.logradouro || '';
          }
          if (document.getElementById('bairro')) {
            document.getElementById('bairro').value = data.bairro || '';
          }
          if (document.getElementById('cidade')) {
            document.getElementById('cidade').value = data.localidade || '';
          }
          if (document.getElementById('uf')) {
            document.getElementById('uf').value = data.uf || '';
          }

          // Aplicar classe para destacar os campos preenchidos automaticamente
          camposEndereco.forEach(campo => {
            const el = document.getElementById(campo);
            if (el && el.value) {
              el.classList.add('autocompleted');
              // Animação sutil para indicar preenchimento automático
              el.style.backgroundColor = '#e8f4ff';
              setTimeout(() => {
                el.style.backgroundColor = '';
              }, 1000);
            }
          });

          // Focar no campo de número após o preenchimento automático
          const numeroInput = document.getElementById('numero');
          if (numeroInput) {
            numeroInput.focus();
          }
        })
        .catch(error => {
          console.error('Erro ao consultar CEP:', error);
          alert('Erro ao consultar o CEP. Verifique sua conexão e tente novamente.');
        })
        .finally(() => {
          // Remover indicador de carregamento
          if (cepInput) {
            cepInput.classList.remove('is-loading');
          }
        });
    }

    // Função para mapa de passos clicável e destacado
    function updateStepMapActive(idx) {
      document.querySelectorAll('.step-link').forEach(function(link, i) {
        if (i === idx) {
          link.classList.add('active');
        } else {
          link.classList.remove('active');
        }
      });
    }

    // Função para mostrar/ocultar detalhes de segurado especial
    function toggleSeguradoEspecialSwitch() {
      const switchInput = document.getElementById('segurado_especial_switch');
      const detalhes = document.getElementById('segurado-especial-detalhes');
      const label = document.getElementById('segurado_especial_label');
      const documentacaoBlock = document.getElementById('documentacao-segurado-block');

      if (switchInput.checked) {
        detalhes.style.display = 'block';
        documentacaoBlock.style.display = 'block';
        label.textContent = 'Exerceu atividade como Segurado Especial: Sim';
      } else {
        detalhes.style.display = 'none';
        documentacaoBlock.style.display = 'none';
        label.textContent = 'Exerceu atividade como Segurado Especial?';

        // Desativa todos os toggles de categoria quando o principal é desativado
        document.querySelectorAll('.categoria-segurado').forEach(function(toggle) {
          toggle.checked = false;
          toggleCategoriaSegurado(toggle);
        });
      }
    }

    // Função para alternar campos de categorias de segurado especial
    function toggleCategoriaSegurado(checkbox) {
      const targetId = checkbox.dataset.target;
      const targetElement = document.getElementById(targetId);

      if (checkbox.checked) {
        targetElement.style.display = 'block';
      } else {
        targetElement.style.display = 'none';
      }

      // Atualiza a visibilidade da documentação relacionada
      atualizaDocumentacaoVisivel();
    }

    // Função para atualizar quais documentações estão visíveis com base nas categorias selecionadas
    function atualizaDocumentacaoVisivel() {
      // Esta função é chamada quando uma categoria é marcada/desmarcada
      // Cada categoria tem sua própria seção de documentação que já está
      // naturalmente visível/oculta junto com o conteúdo da categoria
    }

    // Função para habilitar/desabilitar campo de fim segurado especial
    function atualizaFimSegurado(checkbox) {
      const mesSelect = document.getElementById('mes_fim_segurado');
      const anoSelect = document.getElementById('ano_fim_segurado');

      if (checkbox.checked) {
        // Obter mês e ano atuais
        const dataAtual = new Date();
        const mesAtual = (dataAtual.getMonth() + 1).toString().padStart(2, '0');
        const anoAtual = dataAtual.getFullYear().toString();

        // Definir os valores nos selects
        mesSelect.value = mesAtual;
        anoSelect.value = anoAtual;

        // Desabilitar os selects
        mesSelect.disabled = true;
        anoSelect.disabled = true;
      } else {
        // Habilitar os selects novamente
        mesSelect.disabled = false;
        anoSelect.disabled = false;
      }
    }

    // Adicionar documento de segurado especial
    function adicionarDocSegurado() {
      const novoDoc = document.getElementById('novo_doc_segurado').value.trim();

      if (novoDoc) {
        // Criar um novo documento no grid
        const docsAdicionaisList = document.getElementById('docs-adicionais-list');
        const novoItem = document.createElement('div');
        novoItem.className = 'alert alert-info d-flex align-items-center justify-content-between p-2 mb-2';

        // ID único para o item
        const idItem = 'doc_custom_' + Date.now();

        // HTML do novo documento
        novoItem.innerHTML = `
          <div>
            <i class="fas fa-file-alt me-2"></i>
            <span>${novoDoc}</span>
          </div>
          <button type="button" class="btn btn-sm btn-outline-danger" onclick="this.closest('.alert').remove()">
            <i class="fas fa-times"></i>
          </button>
        `;

        // Adicionar à lista
        docsAdicionaisList.appendChild(novoItem);

        // Limpar campo
        document.getElementById('novo_doc_segurado').value = '';
      }
    }

    // Vínculos dinâmicos (com colunas)
    function addVinculo() {
      const container = document.getElementById('vinculos-list');
      const div = document.createElement('div');
      div.className = 'dynamic-item p-3';
      div.innerHTML = `
        <div class="row align-items-end g-2 mb-2">
          <div class="col-md-3">
            <label class="form-label mb-1">Tipo</label>
            <select class="form-select" required>
              <option value="" selected disabled>Selecione...</option>
              <option value="urbano">Urbano</option>
              <option value="rural">Rural</option>
              <option value="autonomo">Autônomo</option>
              <option value="outro">Outro</option>
            </select>
          </div>
          <div class="col-md-5">
            <label class="form-label mb-1">Empregador/Atividade</label>
            <input type="text" class="form-control" required>
          </div>
          <div class="col-md-4">
            <label class="form-label mb-1">Função</label>
            <input type="text" class="form-control">
          </div>
        </div>
        <div class="row align-items-end g-2 mb-2">
          <div class="col-md-3">
            <label class="form-label mb-1">Início</label>
            <input type="text" class="form-control date-start" placeholder="DD/MM/AAAA">
          </div>
          <div class="col-md-3">
            <label class="form-label mb-1">Fim</label>
            <input type="text" class="form-control date-end" placeholder="DD/MM/AAAA">
          </div>
          <div class="col-md-3">
            <div class="form-check mt-4">
              <input class="form-check-input" type="checkbox" id="trabalho_atual_${Date.now()}">
              <label class="form-check-label" for="trabalho_atual_${Date.now()}">Trabalho atual</label>
            </div>
          </div>
          <div class="col-md-3 text-end">
            <button type="button" class="btn btn-outline-danger btn-sm mt-2" onclick="this.closest('.dynamic-item').remove()">
              <i class="fas fa-trash-alt"></i> Remover
            </button>
          </div>
        </div>
        <div class="row g-2">
          <div class="col-12">
            <label class="form-label mb-1">Observações (opcional)</label>
            <textarea class="form-control" style="height: 50px"></textarea>
          </div>
        </div>
      `;
      container.appendChild(div);

      // Inicializa os campos de data
      flatpickr(div.querySelector('.date-start'), {
        dateFormat: "d/m/Y",
        locale: "pt",
        allowInput: true,
        disableMobile: true
      });
      flatpickr(div.querySelector('.date-end'), {
        dateFormat: "d/m/Y",
        locale: "pt",
        allowInput: true,
        disableMobile: true
      });
      // Checkbox trabalho atual
      const checkboxAtual = div.querySelector('[type="checkbox"]');
      const dataFimInput = div.querySelector('.date-end');
      checkboxAtual.addEventListener('change', function() {
        if (this.checked) {
          dataFimInput.value = "Atual";
          dataFimInput.disabled = true;
        } else {
          dataFimInput.value = "";
          dataFimInput.disabled = false;
        }
      });
    }

    // Doenças dinâmicas (com colunas)
    function addDoenca() {
      const container = document.getElementById('doencas-list');
      const div = document.createElement('div');
      div.className = 'dynamic-item';
      div.innerHTML = `
        <div class="row">
          <div class="col-md-5">
            <label>Doença/Problema:</label>
            <input type="text" placeholder="Nome da doença ou problema">
          </div>
          <div class="col-md-3">
            <label>Data de início:</label>
            <input type="text" class="date-input" placeholder="DD/MM/AAAA">
          </div>
          <div class="col-md-4">
            <label>Tratamentos/Laudos:</label>
            <input type="text" placeholder="Ex: exames, laudos">
          </div>
        </div>
        <button type="button" class="remove-btn" onclick="this.parentNode.remove()">Remover</button>
      `;
      container.appendChild(div);

      // Inicializa o calendário para a data de início
      flatpickr(div.querySelector('.date-input'), {
        dateFormat: "d/m/Y",
        locale: "pt",
        allowInput: true
      });
    }

    // Outros documentos dinâmicos
    function addOutroDocumento() {
      const container = document.getElementById('outros-documentos-list');
      const div = document.createElement('div');
      div.className = 'dynamic-item';
      div.innerHTML = `
        <input type="text" placeholder="Outro documento">
        <button type="button" class="remove-btn" onclick="this.parentNode.remove()">Remover</button>
      `;
      container.appendChild(div);
    }

    // Outros documentos rurais dinâmicos
    function addOutroDocumentoRural() {
      const container = document.getElementById('outros-documentos-list');
      const div = document.createElement('div');
      div.className = 'dynamic-item';
      div.innerHTML = `
        <input type="text" placeholder="Outro documento rural">
        <button type="button" class="remove-btn" onclick="this.parentNode.remove()">Remover</button>
      `;
      container.appendChild(div);
    }

    // Função para alternar status do documento (apresentado/solicitado)
    function toggleDocStatus(element) {
      const docCard = element.closest('.doc-card');
      const currentStatus = docCard.querySelector('.doc-status');

      if (!currentStatus) {
        // Criar novo status se não existir
        const statusElem = document.createElement('div');
        statusElem.className = 'doc-status status-apresentado';
        statusElem.innerHTML = '<i class="fas fa-check-circle me-1"></i> Apresentado';
        docCard.appendChild(statusElem);
      } else if (currentStatus.classList.contains('status-apresentado')) {
        // Alternar para solicitado
        currentStatus.className = 'doc-status status-solicitado';
        currentStatus.innerHTML = '<i class="fas fa-hourglass-half me-1"></i> Solicitado';
      } else {
        // Remover status
        currentStatus.remove();
      }
    }

    // Função para alternar checkbox
    function toggleCheckbox(element) {
      const checkbox = element.querySelector('input[type="checkbox"]');
      checkbox.checked = !checkbox.checked;

      // Atualizar o visual do card quando o checkbox é clicado
      if (checkbox.checked) {
        element.style.backgroundColor = '#e7f1ff';
        element.style.borderColor = '#b8daff';
      } else {
        element.style.backgroundColor = '#f8f9fa';
        element.style.borderColor = '#e0e0e0';
      }

      // Permite alternar o status do documento (apresentado/solicitado)
      if (element.classList.contains('doc-card')) {
        toggleDocStatus(element);
      }
    }

    // Função para adicionar documento médico adicional
    function adicionarDocMedico() {
      const novoDoc = document.getElementById('novo_doc_medico').value.trim();

      if (novoDoc) {
        const docList = document.getElementById('docs-medicos-list');
        const novoItem = document.createElement('div');
        novoItem.className = 'alert alert-info d-flex align-items-center justify-content-between p-2 mb-2';

        // HTML do novo documento médico com botão de remover
        novoItem.innerHTML = `
          <div>
            <i class="fas fa-file-medical me-2"></i>
            <span>${novoDoc}</span>
          </div>
          <button type="button" class="btn btn-sm btn-danger" onclick="this.closest('.alert').remove()">
            <i class="fas fa-times"></i>
          </button>
        `;

        // Adicionar ao container
        docList.appendChild(novoItem);

        // Limpar campo
        document.getElementById('novo_doc_medico').value = '';
      }
    }

    // Função para preencher os seletores de anos
    function preencherSelectAnos(elementId, anoInicial, anoFinal) {
      const select = document.getElementById(elementId);
      if (select) {
        // Limpar opções existentes
        select.innerHTML = '<option value="">Selecione o ano</option>';

        // Adicionar anos em ordem decrescente (mais recentes primeiro)
        for (let ano = anoFinal; ano >= anoInicial; ano--) {
          const option = document.createElement('option');
          option.value = ano;
          option.textContent = ano;
          select.appendChild(option);
        }
      } else {
        console.warn(`Elemento com ID ${elementId} não encontrado`);
      }
    }

    // Função para preencher todos os seletores de anos do formulário
    function inicializarTodosSeletoresAnos() {
      const anoAtual = new Date().getFullYear();
      console.log("Inicializando seletores de anos...");

      // Lista de todos os seletores de ano que precisam ser preenchidos
      const seletores = [
        { id: 'ano_inicio_segurado', anoInicial: 1960, anoFinal: anoAtual },
        { id: 'ano_fim_segurado', anoInicial: 1960, anoFinal: anoAtual },
        { id: 'ano_inicio_doenca', anoInicial: 1960, anoFinal: anoAtual },
        { id: 'ano_inicio_tratamento', anoInicial: 1960, anoFinal: anoAtual }
      ];

      // Preencher cada seletor
      seletores.forEach(seletor => {
        console.log(`Preenchendo seletor: ${seletor.id}`);
        preencherSelectAnos(seletor.id, seletor.anoInicial, seletor.anoFinal);
      });
    }

    // Função para preencher os anos nos selects
    function preencherAnos() {
      const anoAtual = new Date().getFullYear();
      const selectAnoInicio = document.getElementById('ano_inicio_segurado');
      const selectAnoFim = document.getElementById('ano_fim_segurado');

      // Limpar opções existentes
      selectAnoInicio.innerHTML = '<option value="">Selecione o ano</option>';
      selectAnoFim.innerHTML = '<option value="">Selecione o ano</option>';

      // Adicionar anos (de 1950 até o ano atual)
      for (let ano = anoAtual; ano >= 1950; ano--) {
        const optionInicio = document.createElement('option');
        optionInicio.value = ano;
        optionInicio.textContent = ano;
        selectAnoInicio.appendChild(optionInicio);

        const optionFim = document.createElement('option');
        optionFim.value = ano;
        optionFim.textContent = ano;
        selectAnoFim.appendChild(optionFim);
      }
    }

    // Função para atualizar campo de tamanho da propriedade
    function atualizaTamanhoPropriedade(select) {
      const tamanhoInput = document.getElementById('tamanho_propriedade_rural');
      const tipoSelecionado = select.value;

      if (tipoSelecionado === 'pequeno') {
        tamanhoInput.value = '50';
        tamanhoInput.disabled = true;
      } else if (tipoSelecionado === 'medio') {
        tamanhoInput.value = '200';
        tamanhoInput.disabled = true;
      } else if (tipoSelecionado === 'grande') {
        tamanhoInput.value = '201';
        tamanhoInput.disabled = true;
      } else {
        tamanhoInput.value = '';
        tamanhoInput.disabled = false;
      }
    }

    // Inicializar quando o documento estiver pronto
    document.addEventListener('DOMContentLoaded', function() {
      preencherAnos();
    });

    // Function to calculate age based on birth date and display it next to the date
    document.addEventListener('DOMContentLoaded', function() {
      // Set up date of birth field with age calculation
      const nascimentoInput = document.getElementById('nascimento');
      if (nascimentoInput) {
        nascimentoInput.addEventListener('change', function() {
          calculateAndDisplayAge(this);
        });
        nascimentoInput.addEventListener('blur', function() {
          calculateAndDisplayAge(this);
        });
      }
    });

    function calculateAndDisplayAge(inputElement) {
      const dateValue = inputElement.value;
      if (!dateValue) return;

      // Extract date components (assuming DD/MM/YYYY format)
      const parts = dateValue.split('/');
      if (parts.length !== 3) return;

      const day = parseInt(parts[0], 10);
      const month = parseInt(parts[1], 10) - 1; // Month is 0-based in JS
      const year = parseInt(parts[2], 10);

      if (isNaN(day) || isNaN(month) || isNaN(year)) return;

      const birthDate = new Date(year, month, day);
      const today = new Date();

      let age = today.getFullYear() - birthDate.getFullYear();

      // Adjust age if birthday hasn't occurred this year yet
      if (today.getMonth() < birthDate.getMonth() ||
          (today.getMonth() === birthDate.getMonth() && today.getDate() < birthDate.getDate())) {
        age--;
      }

      // Only update if the age is a reasonable value
      if (age >= 0 && age < 120) {
        // Format with the age in parentheses
        inputElement.value = `${parts[0]}/${parts[1]}/${parts[2]} (${age} anos)`;
      }
    }
  </script>
</body>
</html>
