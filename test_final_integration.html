<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Final - Transfer√™ncia de Dados Personal ‚Üí Social</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-frame {
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 20px 0;
            background: white;
        }
        .frame-header {
            background: #f8f9fa;
            padding: 10px 15px;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
        }
        .controls {
            margin: 20px 0;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 5px;
        }
        .controls button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .controls button:hover {
            background: #1976d2;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
        }
        .status.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .status.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .data-display {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste Final - Transfer√™ncia de Dados Personal ‚Üí Social</h1>
        <p>Este teste verifica se os dados preenchidos na p√°gina personal s√£o corretamente transferidos para a p√°gina social.</p>

        <div class="controls">
            <h3>Controles de Teste:</h3>
            <button onclick="preencherDadosPersonal()">1. Preencher Dados na P√°gina Personal</button>
            <button onclick="navegarParaSocial()">2. Navegar para P√°gina Social</button>
            <button onclick="verificarDadosSocial()">3. Verificar Dados na P√°gina Social</button>
            <button onclick="verificarEstadoSistema()">4. Verificar Estado do Sistema</button>
            <button onclick="limparTudo()">üóëÔ∏è Limpar Tudo</button>
        </div>

        <div class="test-frame">
            <div class="frame-header">üìù P√°gina Personal</div>
            <iframe id="personal-frame" src="http://localhost:8080/index.html#personal"></iframe>
        </div>

        <div class="test-frame">
            <div class="frame-header">üë• P√°gina Social</div>
            <iframe id="social-frame" src="http://localhost:8080/index.html#social"></iframe>
        </div>

        <div id="test-results">
            <h3>üìä Resultados dos Testes:</h3>
            <div id="status-display" class="status info">
                Aguardando in√≠cio dos testes...
            </div>
            <div id="data-display" class="data-display" style="display: none;"></div>
        </div>
    </div>

    <script>
        let testData = {
            nome: 'Jo√£o Silva Santos',
            cpf: '123.456.789-00',
            idade: '45'
        };

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status-display');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            console.log(`[TESTE] ${message}`);
        }

        function updateDataDisplay(data) {
            const dataDiv = document.getElementById('data-display');
            dataDiv.textContent = JSON.stringify(data, null, 2);
            dataDiv.style.display = 'block';
        }

        function preencherDadosPersonal() {
            updateStatus('Preenchendo dados na p√°gina personal...', 'info');

            try {
                const personalFrame = document.getElementById('personal-frame');
                const personalWindow = personalFrame.contentWindow;

                // Aguardar o carregamento da p√°gina
                setTimeout(() => {
                    try {
                        const personalDoc = personalWindow.document;

                        // Buscar os campos de entrada na p√°gina personal
                        const nomeInputs = personalDoc.querySelectorAll('input[name="autor_nome[]"]');
                        const cpfInputs = personalDoc.querySelectorAll('input[name="autor_cpf[]"]');
                        const idadeInputs = personalDoc.querySelectorAll('input[name="autor_idade[]"]');

                        if (nomeInputs.length > 0) {
                            nomeInputs[0].value = testData.nome;
                            nomeInputs[0].dispatchEvent(new Event('input', { bubbles: true }));
                            nomeInputs[0].dispatchEvent(new Event('change', { bubbles: true }));
                        }

                        if (cpfInputs.length > 0) {
                            cpfInputs[0].value = testData.cpf;
                            cpfInputs[0].dispatchEvent(new Event('input', { bubbles: true }));
                            cpfInputs[0].dispatchEvent(new Event('change', { bubbles: true }));
                        }

                        if (idadeInputs.length > 0) {
                            idadeInputs[0].value = testData.idade;
                            idadeInputs[0].dispatchEvent(new Event('input', { bubbles: true }));
                            idadeInputs[0].dispatchEvent(new Event('change', { bubbles: true }));
                        }

                        // For√ßar captura do estado
                        if (personalWindow.FormStateManager) {
                            const capturedData = personalWindow.FormStateManager.captureCurrentFormData();
                            updateStatus('‚úÖ Dados preenchidos e capturados com sucesso!', 'success');
                            updateDataDisplay({
                                dadosPreenchidos: testData,
                                dadosCapturados: capturedData
                            });
                        } else {
                            updateStatus('‚ö†Ô∏è FormStateManager n√£o encontrado na p√°gina personal', 'error');
                        }

                    } catch (error) {
                        updateStatus(`‚ùå Erro ao preencher dados: ${error.message}`, 'error');
                        console.error('Erro:', error);
                    }
                }, 2000);

            } catch (error) {
                updateStatus(`‚ùå Erro no preenchimento: ${error.message}`, 'error');
                console.error('Erro:', error);
            }
        }

        function navegarParaSocial() {
            updateStatus('Navegando para a p√°gina social...', 'info');

            try {
                const socialFrame = document.getElementById('social-frame');
                socialFrame.src = 'http://localhost:8080/index.html#social';

                setTimeout(() => {
                    updateStatus('‚úÖ Navega√ß√£o para social conclu√≠da', 'success');
                }, 1000);

            } catch (error) {
                updateStatus(`‚ùå Erro na navega√ß√£o: ${error.message}`, 'error');
                console.error('Erro:', error);
            }
        }

        function verificarDadosSocial() {
            updateStatus('Verificando dados na p√°gina social...', 'info');

            try {
                const socialFrame = document.getElementById('social-frame');
                const socialWindow = socialFrame.contentWindow;

                setTimeout(() => {
                    try {
                        const socialDoc = socialWindow.document;

                        // Buscar os campos que deveriam ser preenchidos
                        const assistidoNome = socialDoc.getElementById('assistido_nome');
                        const assistidoCpf = socialDoc.getElementById('assistido_cpf');
                        const assistidoIdade = socialDoc.getElementById('assistido_idade');

                        const resultados = {
                            nomeEsperado: testData.nome,
                            nomeEncontrado: assistidoNome ? assistidoNome.value : 'Campo n√£o encontrado',
                            cpfEsperado: testData.cpf,
                            cpfEncontrado: assistidoCpf ? assistidoCpf.value : 'Campo n√£o encontrado',
                            idadeEsperada: testData.idade,
                            idadeEncontrada: assistidoIdade ? assistidoIdade.value : 'Campo n√£o encontrado'
                        };

                        // Verificar se os dados foram transferidos corretamente
                        const nomeCorreto = resultados.nomeEncontrado === resultados.nomeEsperado;
                        const cpfCorreto = resultados.cpfEncontrado === resultados.cpfEsperado;
                        const idadeCorreta = resultados.idadeEncontrada === resultados.idadeEsperada;

                        if (nomeCorreto && cpfCorreto && idadeCorreta) {
                            updateStatus('üéâ SUCESSO! Todos os dados foram transferidos corretamente!', 'success');
                        } else {
                            updateStatus(`‚ùå FALHA! Dados n√£o foram transferidos corretamente.`, 'error');
                        }

                        updateDataDisplay({
                            resultados: resultados,
                            statusTransferencia: {
                                nome: nomeCorreto ? 'OK' : 'FALHA',
                                cpf: cpfCorreto ? 'OK' : 'FALHA',
                                idade: idadeCorreta ? 'OK' : 'FALHA'
                            }
                        });

                    } catch (error) {
                        updateStatus(`‚ùå Erro ao verificar dados social: ${error.message}`, 'error');
                        console.error('Erro:', error);
                    }
                }, 2000);

            } catch (error) {
                updateStatus(`‚ùå Erro na verifica√ß√£o: ${error.message}`, 'error');
                console.error('Erro:', error);
            }
        }

        function verificarEstadoSistema() {
            updateStatus('Verificando estado do sistema...', 'info');

            try {
                const personalFrame = document.getElementById('personal-frame');
                const socialFrame = document.getElementById('social-frame');

                setTimeout(() => {
                    const personalWindow = personalFrame.contentWindow;
                    const socialWindow = socialFrame.contentWindow;

                    const estadoSistema = {
                        personal: {
                            FormStateManager: personalWindow.FormStateManager ? 'Dispon√≠vel' : 'N√£o encontrado',
                            estadoAtual: personalWindow.FormStateManager ? personalWindow.FormStateManager.getState() : null
                        },
                        social: {
                            FormStateManager: socialWindow.FormStateManager ? 'Dispon√≠vel' : 'N√£o encontrado',
                            estadoAtual: socialWindow.FormStateManager ? socialWindow.FormStateManager.getState() : null
                        },
                        localStorage: {
                            personal: localStorage.getItem('fiap_form_data_personal') ? 'Dados encontrados' : 'Vazio',
                            social: localStorage.getItem('fiap_form_data_social') ? 'Dados encontrados' : 'Vazio'
                        }
                    };

                    updateStatus('üìä Estado do sistema verificado', 'info');
                    updateDataDisplay(estadoSistema);

                }, 1000);

            } catch (error) {
                updateStatus(`‚ùå Erro ao verificar estado: ${error.message}`, 'error');
                console.error('Erro:', error);
            }
        }

        function limparTudo() {
            updateStatus('Limpando todos os dados...', 'info');

            try {
                // Limpar localStorage
                localStorage.removeItem('fiap_form_data_personal');
                localStorage.removeItem('fiap_form_data_social');
                localStorage.removeItem('fiap_form_data');

                // Recarregar frames
                document.getElementById('personal-frame').src = 'http://localhost:8080/index.html#personal';
                document.getElementById('social-frame').src = 'http://localhost:8080/index.html#social';

                // Limpar display
                document.getElementById('data-display').style.display = 'none';

                updateStatus('üóëÔ∏è Todos os dados foram limpos', 'success');

            } catch (error) {
                updateStatus(`‚ùå Erro ao limpar: ${error.message}`, 'error');
                console.error('Erro:', error);
            }
        }

        // Aguardar carregamento inicial
        window.onload = function() {
            updateStatus('üöÄ Teste de transfer√™ncia de dados carregado. Clique nos bot√µes para executar os testes em sequ√™ncia.', 'info');
        };
    </script>
</body>
</html>
