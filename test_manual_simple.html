<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Manual - Dados Personal</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-container { max-width: 800px; margin: 0 auto; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .form-section { margin: 20px 0; padding: 15px; background: #f9f9f9; border-radius: 5px; }
        input, button { padding: 10px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007bff; color: white; border: none; cursor: pointer; }
        .log { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 4px; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Teste Manual - Dados Personal</h1>

        <div class="form-section">
            <h3>Simular Formul√°rio Personal</h3>
            <form id="personal-form">
                <input type="text" name="autor_nome[]" placeholder="Nome" value="Jo√£o Silva Santos">
                <input type="text" name="autor_cpf[]" placeholder="CPF" value="123.456.789-00">
                <input type="text" name="autor_idade[]" placeholder="Idade" value="45">
                <button type="button" onclick="capturarDados()">Capturar Dados</button>
            </form>
        </div>

        <div class="form-section">
            <h3>Simular Formul√°rio Social</h3>
            <form id="social-form">
                <input type="text" name="familiar_nome[]" id="assistido_nome" placeholder="Nome do Assistido" readonly>
                <input type="text" name="familiar_cpf[]" id="assistido_cpf" placeholder="CPF do Assistido" readonly>
                <input type="text" name="familiar_idade[]" id="assistido_idade" placeholder="Idade do Assistido" readonly>
                <button type="button" onclick="preencherAssistido()">Preencher Assistido</button>
            </form>
        </div>

        <div class="form-section">
            <h3>Testes de Sistema</h3>
            <button onclick="verificarEstado()">Verificar Estado</button>
            <button onclick="limparEstado()">Limpar Estado</button>
            <button onclick="testarCaptura()">Testar Captura Arrays</button>
        </div>

        <div id="logs" class="log">
            Logs aparecer√£o aqui...
        </div>
    </div>

    <!-- Carregar scripts necess√°rios -->
    <script src="js/state.js"></script>
    <script>
        function log(message) {
            const logsDiv = document.getElementById('logs');
            logsDiv.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            logsDiv.scrollTop = logsDiv.scrollHeight;
            console.log(message);
        }

        window.onload = function() {
            log('üöÄ Teste manual carregado');
            log('FormStateManager dispon√≠vel: ' + (typeof window.FormStateManager !== 'undefined'));
            log('formStateManager dispon√≠vel: ' + (typeof window.formStateManager !== 'undefined'));
            log('stateManager dispon√≠vel: ' + (typeof window.stateManager !== 'undefined'));
        };

        function capturarDados() {
            log('üìù Capturando dados do formul√°rio personal...');

            try {
                if (window.formStateManager) {
                    const dadosCapturados = window.formStateManager.captureCurrentFormData();

                    // Simular que estamos na p√°gina personal
                    if (!window.formStateManager.formData) {
                        window.formStateManager.formData = {};
                    }
                    window.formStateManager.formData.personal = dadosCapturados;

                    log('‚úÖ Dados capturados e salvos em formData.personal:');
                    log(JSON.stringify(dadosCapturados, null, 2));

                    // Salvar tamb√©m no localStorage
                    localStorage.setItem('fiap_form_data_personal', JSON.stringify(dadosCapturados));
                    log('üíæ Dados salvos no localStorage personal');

                } else {
                    log('‚ùå FormStateManager n√£o dispon√≠vel');
                }
            } catch (error) {
                log('‚ùå Erro na captura: ' + error.message);
                console.error(error);
            }
        }

        function preencherAssistido() {
            log('üë• Preenchendo dados do assistido...');

            try {
                // Simular a fun√ß√£o preencherDadosAssistido do social.js
                const nomeInput = document.getElementById('assistido_nome');
                const cpfInput = document.getElementById('assistido_cpf');
                const idadeInput = document.getElementById('assistido_idade');

                let nomeValue = 'Assistido';
                let cpfValue = '';
                let idadeValue = '';
                let fonteUtilizada = 'padr√£o';

                // Verificar formStateManager.formData.personal
                if (window.formStateManager && window.formStateManager.formData && window.formStateManager.formData.personal) {
                    const personalData = window.formStateManager.formData.personal;
                    log('üîç Dados encontrados em formStateManager.formData.personal:');
                    log(JSON.stringify(personalData, null, 2));

                    if (personalData['autor_nome[]'] && personalData['autor_nome[]'].length > 0) {
                        nomeValue = personalData['autor_nome[]'][0];
                        fonteUtilizada = 'formStateManager.personal';
                        log('‚úÖ Nome encontrado: ' + nomeValue);
                    }

                    if (personalData['autor_cpf[]'] && personalData['autor_cpf[]'].length > 0) {
                        cpfValue = personalData['autor_cpf[]'][0];
                        log('‚úÖ CPF encontrado: ' + cpfValue);
                    }

                    if (personalData['autor_idade[]'] && personalData['autor_idade[]'].length > 0) {
                        idadeValue = personalData['autor_idade[]'][0];
                        log('‚úÖ Idade encontrada: ' + idadeValue);
                    }
                } else {
                    log('‚ùå Dados personal n√£o encontrados em formStateManager');

                    // Tentar localStorage
                    const personalStorage = localStorage.getItem('fiap_form_data_personal');
                    if (personalStorage) {
                        const personalData = JSON.parse(personalStorage);
                        log('üîç Tentando localStorage personal:');
                        log(JSON.stringify(personalData, null, 2));

                        if (personalData['autor_nome[]'] && personalData['autor_nome[]'].length > 0) {
                            nomeValue = personalData['autor_nome[]'][0];
                            fonteUtilizada = 'localStorage.personal';
                            log('‚úÖ Nome encontrado no localStorage: ' + nomeValue);
                        }

                        if (personalData['autor_cpf[]'] && personalData['autor_cpf[]'].length > 0) {
                            cpfValue = personalData['autor_cpf[]'][0];
                            log('‚úÖ CPF encontrado no localStorage: ' + cpfValue);
                        }

                        if (personalData['autor_idade[]'] && personalData['autor_idade[]'].length > 0) {
                            idadeValue = personalData['autor_idade[]'][0];
                            log('‚úÖ Idade encontrada no localStorage: ' + idadeValue);
                        }
                    }
                }

                // Preencher os campos
                nomeInput.value = nomeValue;
                cpfInput.value = cpfValue;
                idadeInput.value = idadeValue;

                log(`üìã Campos preenchidos - Fonte: ${fonteUtilizada}`);
                log(`Nome: ${nomeValue}, CPF: ${cpfValue}, Idade: ${idadeValue}`);

            } catch (error) {
                log('‚ùå Erro no preenchimento: ' + error.message);
                console.error(error);
            }
        }

        function verificarEstado() {
            log('üìä Verificando estado do sistema...');

            try {
                if (window.formStateManager) {
                    const estado = window.formStateManager.getState();
                    log('üóÇÔ∏è Estado atual do formStateManager:');
                    log(JSON.stringify(estado, null, 2));

                    if (window.formStateManager.formData) {
                        log('üìÅ FormData dispon√≠vel:');
                        log(JSON.stringify(window.formStateManager.formData, null, 2));
                    }
                } else {
                    log('‚ùå FormStateManager n√£o dispon√≠vel');
                }

                // Verificar localStorage
                const personalStorage = localStorage.getItem('fiap_form_data_personal');
                const socialStorage = localStorage.getItem('fiap_form_data_social');

                log('üíæ LocalStorage personal: ' + (personalStorage ? 'Dados encontrados' : 'Vazio'));
                log('üíæ LocalStorage social: ' + (socialStorage ? 'Dados encontrados' : 'Vazio'));

            } catch (error) {
                log('‚ùå Erro na verifica√ß√£o: ' + error.message);
                console.error(error);
            }
        }

        function limparEstado() {
            log('üóëÔ∏è Limpando estado...');

            try {
                localStorage.removeItem('fiap_form_data_personal');
                localStorage.removeItem('fiap_form_data_social');
                localStorage.removeItem('fiap_form_data');

                if (window.formStateManager) {
                    window.formStateManager.formData = {};
                }

                // Limpar campos
                document.getElementById('assistido_nome').value = '';
                document.getElementById('assistido_cpf').value = '';
                document.getElementById('assistido_idade').value = '';

                log('‚úÖ Estado limpo');

            } catch (error) {
                log('‚ùå Erro na limpeza: ' + error.message);
            }
        }

        function testarCaptura() {
            log('üß™ Testando captura de arrays...');

            try {
                const form = document.getElementById('personal-form');
                if (window.formStateManager) {
                    const dados = window.formStateManager.captureCurrentFormData();
                    log('üìã Dados capturados:');
                    log(JSON.stringify(dados, null, 2));

                    // Verificar se arrays foram detectados
                    const temArrays = Object.keys(dados).some(key => Array.isArray(dados[key]));
                    log('üîç Arrays detectados: ' + (temArrays ? 'SIM' : 'N√ÉO'));

                } else {
                    log('‚ùå FormStateManager n√£o dispon√≠vel');
                }
            } catch (error) {
                log('‚ùå Erro no teste: ' + error.message);
            }
        }
    </script>
</body>
</html>
